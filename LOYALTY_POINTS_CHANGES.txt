// Loyalty Points Calculation Logic for ModernQueueCard.tsx
// Add this import at the top with other imports:
import firebase from 'firebase/compat/app';

// Replace the handleClaimOrder function with this version:
const handleClaimOrder = async () => {
  if (isUpdating) return;
  setIsUpdating(true);
  try {
    // Calculate loyalty points based on order sizes
    let loyaltyPoints = 0;
    order.orderItems.forEach(item => {
      // Check if the product name contains size information
      const productName = item.productName.toLowerCase();
      
      // Coffee and drinks: Grande = 4 points, Venti = 5 points
      if (productName.includes('grande')) {
        loyaltyPoints += 4 * item.quantity;
      } else if (productName.includes('venti')) {
        loyaltyPoints += 5 * item.quantity;
      }
      // Meals: Ala Carte = 4 points, Combo = 5 points
      else if (productName.includes('ala carte')) {
        loyaltyPoints += 4 * item.quantity;
      } else if (productName.includes('combo')) {
        loyaltyPoints += 5 * item.quantity;
      }
    });

    // Update order status
    await db.collection('orders').doc(order.id).update({
      status: 'completed',
      completedAt: new Date(),
      updatedAt: new Date(),
    });

    // Award loyalty points to user if any points were earned
    if (loyaltyPoints > 0 && order.userId) {
      await db.collection('users').doc(order.userId).update({
        loyaltyPoints: firebase.firestore.FieldValue.increment(loyaltyPoints),
      });
      showToast(`Order completed! Earned ${loyaltyPoints} loyalty points!`);
    } else {
      showToast('Order marked as completed!');
    }
  } catch (error) {
    console.error("Error updating order status:", error);
    showToast("Failed to update order status. Please try again.");
  } finally {
    setIsUpdating(false);
  }
};

// Also update button text from "I've Received My Order" to "I've Already Picked Up"
// Around line 493, change:
// I've Received My Order
// to:
// I've Already Picked Up
