import{c as D,j as e,B as z,T as Y,r,n as H,C as S,U as J,x as ne,k as L,X as oe,l as O,p as W,o as fe,m as pe,V as ge,u as ce,W as ye,Q as X,Y as Z,Z as _,_ as V,d as ee,h as B,E as je,D as be,y as se,s as Ne,J as we,H as ve,F as ke}from"./index-CeTvPb5i.js";import{B as b}from"./Button-7EiVU78F.js";import{C as $}from"./coffee-BfFzb84j.js";import{S as de}from"./star-BuyZ9k-S.js";import{C as me}from"./calendar-BS-dkdsU.js";import{f as Q}from"./format-BoV-TgZi.js";import{S as xe}from"./save-BaK_6ap_.js";import{S as K}from"./shopping-bag-Df_4vLZe.js";import{I as G}from"./Input-CvH-8zzi.js";import{B as Ce}from"./bell-2tB5X9ux.js";import{S as te,f as Se}from"./StarRating-DRJ7W5rW.js";import{M as he}from"./message-square-DPCCtN5P.js";import{T as Pe}from"./thumbs-up-D_2d3uTi.js";import{S as Ie}from"./send-BunkZdFk.js";import{S as Ae}from"./settings-CSIZuYnK.js";import{S as Me}from"./square-pen-B6cL6_2p.js";import"./en-US-wfBU2YNu.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Fe=D("camera",Ee);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]],Oe=D("circle-dollar-sign",Re);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],Ue=D("key",Te);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],ze=D("palette",$e);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ae=D("upload",De),He=({user:s,onEditPhoto:l})=>{const d=(m,t)=>`${m.charAt(0)}${t.charAt(0)}`.toUpperCase(),i=m=>m==="admin"?"Admin":m==="employee"?"Employee":m==="customer"?"Customer":"";return e.jsxs("div",{className:"w-full bg-white shadow-sm",children:[e.jsx("div",{className:"relative h-48 w-full overflow-hidden bg-gradient-to-r from-coffee-600 via-coffee-500 to-primary-600",children:e.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:"radial-gradient(circle at 2px 2px, white 1px, transparent 0)",backgroundSize:"24px 24px"}})}),e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"relative -mt-16 mb-6 flex flex-col items-center",children:[e.jsxs("div",{className:"relative h-32 w-32 transition-transform hover:scale-105",children:[s.photoURL?e.jsx("img",{src:s.photoURL,alt:`${s.firstName} ${s.lastName}`,className:"h-full w-full rounded-full border-4 border-white object-cover shadow-xl"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full border-4 border-white bg-gradient-to-br from-primary-400 to-primary-600 text-white shadow-xl",children:e.jsx("span",{className:"font-display text-4xl font-bold",children:d(s.firstName,s.lastName)})}),e.jsx("button",{onClick:l,className:"absolute bottom-1 right-1 flex h-9 w-9 items-center justify-center rounded-full bg-white text-gray-600 shadow-lg transition-all hover:bg-primary-50 hover:text-primary-600","aria-label":"Edit profile photo",children:e.jsx(Fe,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsxs("h1",{className:"font-display text-3xl font-bold text-gray-900",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-gray-500 font-medium",children:s.email}),e.jsxs("div",{className:"mt-3 flex flex-wrap justify-center gap-2",children:[s.role&&e.jsxs(z,{className:"bg-blue-50 text-blue-700 border border-blue-100 px-3 py-1",children:[e.jsx(Y,{className:"mr-1.5 h-3.5 w-3.5"}),e.jsx("span",{children:i(s.role)})]}),e.jsx(z,{className:`px-3 py-1 border ${s.tier==="gold"?"bg-yellow-50 text-yellow-700 border-yellow-200":s.tier==="silver"?"bg-gray-50 text-gray-700 border-gray-200":"bg-orange-50 text-orange-800 border-orange-200"}`,children:e.jsxs("span",{className:"capitalize font-semibold",children:[s.tier," Member"]})})]})]})]})}),e.jsx("div",{className:"border-t border-gray-100 bg-gray-50/50",children:e.jsxs("div",{className:"container mx-auto grid grid-cols-2 gap-4 px-6 py-6 sm:grid-cols-4",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center border-r border-gray-200 last:border-0 sm:border-r",children:[e.jsx("div",{className:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-orange-100 text-orange-600",children:e.jsx($,{className:"h-5 w-5"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.totalOrders}),e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Orders"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center border-r border-gray-200 last:border-0 sm:border-r",children:[e.jsx("div",{className:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-green-100 text-green-600",children:e.jsx(Oe,{className:"h-5 w-5"})}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["₱",s.totalSpent.toLocaleString()]}),e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Spent"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center border-r border-gray-200 last:border-0 sm:border-r",children:[e.jsx("div",{className:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-yellow-100 text-yellow-600",children:e.jsx(de,{className:"h-5 w-5"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.currentPoints}),e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Points"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-blue-100 text-blue-600",children:e.jsx(me,{className:"h-5 w-5"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Q(s.createdAt,"MMM yyyy")}),e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Joined"})]})]})})]})},qe=({user:s,onSave:l,onCancel:d})=>{const[i,m]=r.useState({firstName:s.firstName,lastName:s.lastName,phone:s.phone||""}),[t,p]=r.useState({}),[g,y]=r.useState(!1),[v,h]=r.useState(!1),{showToast:f}=H();r.useEffect(()=>{const x=i.firstName!==s.firstName||i.lastName!==s.lastName||i.phone!==(s.phone||"");h(x)},[i,s]);const u=()=>{const x={};return i.firstName.length<2&&(x.firstName="First name must be at least 2 characters."),i.lastName.length<2&&(x.lastName="Last name must be at least 2 characters."),i.phone&&!/^(09|\+639)\d{9}$/.test(i.phone)&&(x.phone="Invalid Philippine phone number format."),p(x),Object.keys(x).length===0},c=x=>{m({...i,[x.target.name]:x.target.value})},C=x=>{x.preventDefault(),u()&&(y(!0),setTimeout(()=>{l(i),y(!1),f("Profile updated successfully!")},1e3))};return e.jsxs(S,{className:"w-full",children:[e.jsx("h2",{className:"mb-4 font-display text-xl font-bold text-coffee-900",children:"Edit Profile Information"}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"firstName",className:"block text-sm font-medium text-gray-700",children:"First Name"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(J,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",name:"firstName",id:"firstName",value:i.firstName,onChange:c,className:"w-full rounded-md border-gray-300 pl-10 shadow-sm focus:border-primary-500 focus:ring-primary-500",required:!0})]}),t.firstName&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.firstName})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"lastName",className:"block text-sm font-medium text-gray-700",children:"Last Name"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(J,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",name:"lastName",id:"lastName",value:i.lastName,onChange:c,className:"w-full rounded-md border-gray-300 pl-10 shadow-sm focus:border-primary-500 focus:ring-primary-500",required:!0})]}),t.lastName&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.lastName})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"tel",name:"phone",id:"phone",value:i.phone,onChange:c,className:"w-full rounded-md border-gray-300 pl-10 shadow-sm focus:border-primary-500 focus:ring-primary-500"})]}),t.phone&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.phone})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(L,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"email",name:"email",id:"email",value:s.email||"",className:"w-full rounded-md border-gray-300 bg-gray-100 pl-10 text-gray-500 shadow-sm",disabled:!0,readOnly:!0})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Contact support to change your email address."})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-gray-200 pt-4",children:[e.jsxs(b,{type:"button",variant:"ghost",onClick:d,children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Cancel"]}),e.jsxs(b,{type:"submit",variant:"primary",disabled:!v||g,children:[g?e.jsx(O,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Save Changes"]})]})]})]})},re={completed:{icon:fe,color:"bg-green-100 text-green-800"},cancelled:{icon:oe,color:"bg-red-100 text-red-800"},preparing:{icon:$,color:"bg-blue-100 text-blue-800"},waiting:{icon:$,color:"bg-yellow-100 text-yellow-800"},ready:{icon:$,color:"bg-purple-100 text-purple-800"}},Le={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},_e={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},Ve=({order:s})=>{var y,v;const l=((y=re[s.status])==null?void 0:y.icon)||$,d=((v=re[s.status])==null?void 0:v.color)||"bg-gray-100 text-gray-800",{addMultipleToCart:i,showToast:m}=H(),{products:t}=pe(),p=()=>{const h=[],f=[];for(const u of s.orderItems){const c=t.find(j=>j.id===u.productId);if(!c||!c.available||c.stock===0){f.push(u.productName);continue}const C=u.productName.match(/\((Grande|Venti)\)$/),x=C?C[1]:null;if(!x){f.push(u.productName);continue}const P=c.sizes.find(j=>j.name===x);if(!P){f.push(u.productName);continue}h.push({product:c,selectedSize:P,quantity:u.quantity,customizations:u.customizations})}h.length>0&&i(h),f.length>0&&m(`Could not add: ${f.join(", ")}. They may be unavailable.`)},g=()=>{const h=s.orderItems;return h.length<=2?h.map(u=>`${u.quantity}x ${u.productName}`).join(", "):`${h.slice(0,2).map(u=>u.productName).join(", ")}, and ${h.length-2} more item(s)`};return e.jsx(S,{hover:!0,className:"transition-shadow duration-300",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-mono text-sm font-semibold text-primary-700",children:s.orderNumber}),e.jsxs(z,{className:`capitalize ${d}`,children:[e.jsx(l,{className:"mr-1 h-3 w-3"}),s.status]})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:Q(s.timestamp,"MMM dd, yyyy • hh:mm a")}),e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:g()}),s.status==="cancelled"&&s.cancellationReason&&e.jsxs("div",{className:"mt-2 rounded-md bg-red-50 p-2 text-sm text-red-700 border border-red-100",children:[e.jsx("span",{className:"font-semibold",children:"Reason:"})," ",s.cancellationReason]})]}),e.jsxs("div",{className:"flex-shrink-0 text-right sm:ml-4",children:[e.jsxs("p",{className:"font-display text-2xl font-bold text-coffee-900",children:["₱",s.totalAmount.toFixed(2)]}),e.jsxs(b,{size:"sm",variant:"secondary",className:"mt-2",onClick:p,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Reorder"]})]})]})})},le=({orders:s,limit:l,showViewAll:d,onViewAll:i})=>{const m=[...s].sort((p,g)=>g.timestamp.getTime()-p.timestamp.getTime()),t=l?m.slice(0,l):m;return s.length===0?e.jsxs("div",{className:"py-16 text-center",children:[e.jsx(K,{className:"mx-auto h-16 w-16 text-gray-300"}),e.jsx("h3",{className:"mt-4 text-xl font-semibold text-gray-800",children:"No Orders Yet"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Your past orders will appear here."}),e.jsx(b,{size:"lg",className:"mt-6",children:"Browse Menu"})]}):e.jsxs("div",{children:[e.jsx(W.div,{className:"space-y-4",variants:Le,initial:"hidden",animate:"visible",children:t.map(p=>e.jsx(W.div,{variants:_e,layout:!0,children:e.jsx(Ve,{order:p})},p.id))}),d&&m.length>(l||0)&&e.jsx("div",{className:"mt-6 text-center",children:e.jsx(b,{variant:"ghost",onClick:i,children:"View All Orders"})})]})},U=({label:s,description:l,enabled:d,onChange:i,Icon:m})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-800",children:s}),e.jsx("p",{className:"text-sm text-gray-500",children:l})]})]}),e.jsx("button",{type:"button",className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 ${d?"bg-primary-600":"bg-gray-200"}`,role:"switch","aria-checked":d,onClick:()=>i(!d),children:e.jsx("span",{"aria-hidden":"true",className:`inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${d?"translate-x-5":"translate-x-0"}`})})]}),Be=({preferences:s,onUpdatePreferences:l})=>{const[d,i]=r.useState(s),[m,t]=r.useState(!1),[p,g]=r.useState(!1),{showToast:y}=H(),{updateUserPassword:v}=ce(),h=(a,k,A)=>{const q={...d,[a]:{...d[a],[k]:A}};i(q),l({[a]:q[a]}),y("Preferences updated!")},[f,u]=r.useState({current:"",new:"",confirm:""}),[c,C]=r.useState({current:!1,new:!1,confirm:!1}),[x,P]=r.useState(!1),[j,N]=r.useState(null),[T,R]=r.useState({password:"",checkbox:!1}),[n,w]=r.useState(!1),F=a=>{u({...f,[a.target.name]:a.target.value}),N(null)},I=a=>{C({...c,[a]:!c[a]})},E=async a=>{if(a.preventDefault(),N(null),f.new!==f.confirm){N("New passwords do not match.");return}if(f.new.length<6){N("Password must be at least 6 characters.");return}P(!0);try{await v(f.current,f.new),y("Password updated successfully!"),t(!1),u({current:"",new:"",confirm:""})}catch(k){console.error("Error updating password:",k),k.code==="auth/wrong-password"?N("Incorrect current password."):N("Failed to update password. Please try again.")}finally{P(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(S,{children:[e.jsx("h2",{className:"mb-4 font-display text-2xl font-bold text-coffee-900",children:"Preferences & Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-500",children:"Notifications"}),e.jsx(U,{Icon:Ce,label:"Push Notifications",description:"Get notified when order is ready",enabled:d.notifications.push,onChange:a=>h("notifications","push",a)}),e.jsx(U,{Icon:L,label:"Email Updates",description:"Receive order updates via email",enabled:d.notifications.emailUpdates,onChange:a=>h("notifications","emailUpdates",a)}),e.jsx(U,{Icon:L,label:"Marketing Emails",description:"Get news and promotions",enabled:d.notifications.marketing,onChange:a=>h("notifications","marketing",a)})]}),e.jsx("hr",{className:"my-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ze,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"font-semibold text-gray-800",children:"Appearance"})]}),e.jsx("div",{className:"flex gap-2 rounded-full bg-gray-100 p-1",children:["light","dark","auto"].map(a=>e.jsx("button",{onClick:()=>h("theme","theme",a),className:`w-full rounded-full py-1.5 text-sm font-semibold capitalize transition-colors ${d.theme===a?"bg-primary-600 text-white shadow":"text-gray-600 hover:bg-primary-50"}`,children:a},a))})]}),e.jsx("hr",{className:"my-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-500",children:"Privacy"}),e.jsx(U,{Icon:Y,label:"Share anonymous usage data",description:"Help us improve our services",enabled:d.privacy.shareUsageData,onChange:a=>h("privacy","shareUsageData",a)}),e.jsx(U,{Icon:Y,label:"Personalized recommendations",description:"Get recommendations based on your activity",enabled:d.privacy.personalizedRecs,onChange:a=>h("privacy","personalizedRecs",a)})]})]}),e.jsxs(S,{className:"mt-6 border-l-4 border-red-500",children:[e.jsx("h2",{className:"mb-4 font-display text-xl font-bold text-red-700",children:"Account Management"}),e.jsxs("div",{className:"flex flex-col items-start gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Change Password"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Update your password for better security."})]}),e.jsxs(b,{variant:"secondary",onClick:()=>t(!0),children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),"Change Password"]})]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"flex flex-col items-start gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Delete Account"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Permanently delete your account and all data."})]}),e.jsxs(b,{variant:"danger",onClick:()=>g(!0),children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Delete Account"]})]})]}),e.jsx(X,{isOpen:m,onClose:()=>t(!1),title:"Change Password",children:e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[j&&e.jsxs("div",{className:"p-3 bg-red-50 text-red-600 text-sm rounded-lg flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),j]}),e.jsx(G,{label:"Current Password",type:c.current?"text":"password",name:"current",value:f.current,onChange:F,required:!0,endIcon:e.jsx("button",{type:"button",onClick:()=>I("current"),className:"text-gray-900 hover:text-gray-700 cursor-pointer",children:c.current?e.jsx(_,{className:"h-4 w-4"}):e.jsx(V,{className:"h-4 w-4"})})}),e.jsx(G,{label:"New Password",type:c.new?"text":"password",name:"new",value:f.new,onChange:F,required:!0,endIcon:e.jsx("button",{type:"button",onClick:()=>I("new"),className:"text-gray-900 hover:text-gray-700 cursor-pointer",children:c.new?e.jsx(_,{className:"h-4 w-4"}):e.jsx(V,{className:"h-4 w-4"})})}),e.jsx(G,{label:"Confirm New Password",type:c.confirm?"text":"password",name:"confirm",value:f.confirm,onChange:F,required:!0,endIcon:e.jsx("button",{type:"button",onClick:()=>I("confirm"),className:"text-gray-900 hover:text-gray-700 cursor-pointer",children:c.confirm?e.jsx(_,{className:"h-4 w-4"}):e.jsx(V,{className:"h-4 w-4"})})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(b,{type:"button",variant:"ghost",onClick:()=>t(!1),children:"Cancel"}),e.jsxs(b,{type:"submit",disabled:x,children:[x?e.jsx(O,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Update Password"]})]})]})}),e.jsx(X,{isOpen:p,onClose:()=>g(!1),title:"Delete Account",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:e.jsx(Z,{className:"h-6 w-6 text-red-600","aria-hidden":"true"})}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"Are you absolutely sure?"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"This action cannot be undone. This will permanently delete your account, orders, and rewards."}),e.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Account deletion functionality is coming soon."})]})})]})},Ge=({user:s})=>{const[l,d]=r.useState("feedback"),[i,m]=r.useState(0),[t,p]=r.useState("food"),[g,y]=r.useState(""),[v,h]=r.useState(!1),[f,u]=r.useState([]),[c,C]=r.useState(!0),[x,P]=r.useState(null),{showToast:j}=H();r.useEffect(()=>{if(!s)return;const w=ee.collection("feedback").where("userId","==",s.uid).onSnapshot(F=>{const I=[];F.forEach(E=>{var k,A;const a=E.data();I.push({id:E.id,...a,createdAt:(k=a.createdAt)==null?void 0:k.toDate(),updatedAt:(A=a.updatedAt)==null?void 0:A.toDate()})}),I.sort((E,a)=>{var k,A;return(((k=a.createdAt)==null?void 0:k.getTime())||0)-(((A=E.createdAt)==null?void 0:A.getTime())||0)}),u(I),C(!1)});return()=>w()},[s]);const N=n=>{d(n),y(""),n==="issue"?(m(0),p("system")):(m(0),p("food"))},T=async n=>{if(n.preventDefault(),l==="feedback"&&i===0){j("Please provide a rating.");return}if(g.trim().length<10){j("Please provide a description (at least 10 characters).");return}h(!0);try{await ee.collection("feedback").add({userId:s.uid,rating:l==="issue"?0:i,category:t,comment:g,status:"pending",createdAt:se.firestore.FieldValue.serverTimestamp(),updatedAt:se.firestore.FieldValue.serverTimestamp(),type:l}),j(l==="issue"?"Issue reported successfully!":"Feedback submitted successfully!"),m(0),y(""),l==="feedback"&&p("food")}catch(w){console.error("Error submitting feedback: ",w),j("Failed to submit. Please try again.")}finally{h(!1)}},R={pending:"bg-yellow-100 text-yellow-800",published:"bg-blue-100 text-blue-800",resolved:"bg-green-100 text-green-800"};return e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(S,{children:[e.jsx("h2",{className:"mb-4 font-display text-2xl font-bold text-coffee-900",children:"Your History"}),c?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(O,{className:"h-8 w-8 animate-spin text-primary-600"})}):f.length>0?e.jsx("div",{className:"space-y-3",children:f.map(n=>e.jsxs("div",{className:"rounded-lg border border-gray-200",children:[e.jsxs("button",{onClick:()=>P(x===n.id?null:n.id),className:"flex w-full items-center justify-between p-4 text-left",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[n.rating>0?e.jsx(te,{rating:n.rating,size:"sm",readonly:!0}):e.jsxs("div",{className:"flex items-center gap-1 text-xs font-bold text-red-600 bg-red-50 px-2 py-1 rounded-full",children:[e.jsx(B,{className:"h-3 w-3"}),"Issue Report"]}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx("p",{className:"font-semibold text-gray-800 truncate",children:n.comment}),e.jsx("p",{className:"text-xs text-gray-500",children:n.createdAt?Se(n.createdAt,{addSuffix:!0}):"Just now"})]})]}),e.jsx(je,{className:`h-5 w-5 transform transition-transform ${x===n.id?"rotate-180":""}`})]}),e.jsx(be,{children:x===n.id&&e.jsx(W.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"border-t p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(z,{className:"capitalize bg-gray-100 text-gray-600",children:n.category}),e.jsx(z,{className:`capitalize ${R[n.status]}`,children:n.status})]}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:n.comment}),n.response&&e.jsxs("div",{className:"mt-4 rounded-md border-l-4 border-primary-400 bg-primary-50 p-3",children:[e.jsx("p",{className:"font-semibold text-primary-800",children:"Response from Rush Coffee:"}),e.jsxs("p",{className:"mt-1 text-sm text-primary-700 italic",children:['"',n.response,'"']})]})]})})})]},n.id))}):e.jsxs("div",{className:"py-10 text-center text-gray-500",children:[e.jsx(he,{className:"mx-auto h-12 w-12 text-gray-300"}),e.jsx("p",{className:"mt-2 font-semibold",children:"No history found."}),e.jsx("p",{className:"text-sm",children:"Share your thoughts or report issues using the form!"})]})]})}),e.jsx("div",{children:e.jsxs(S,{children:[e.jsxs("div",{className:"flex p-1 mb-6 bg-gray-100 rounded-lg",children:[e.jsxs("button",{onClick:()=>N("feedback"),className:`flex-1 flex items-center justify-center gap-2 py-2 text-sm font-medium rounded-md transition-all ${l==="feedback"?"bg-white text-primary-700 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(Pe,{className:"h-4 w-4"}),"Give Feedback"]}),e.jsxs("button",{onClick:()=>N("issue"),className:`flex-1 flex items-center justify-center gap-2 py-2 text-sm font-medium rounded-md transition-all ${l==="issue"?"bg-white text-red-600 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(B,{className:"h-4 w-4"}),"Report Issue"]})]}),e.jsx("h2",{className:"mb-4 font-display text-2xl font-bold text-coffee-900",children:l==="feedback"?"Share Your Experience":"Report a Problem"}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[l==="feedback"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Overall Rating"}),e.jsx(te,{rating:i,onRatingChange:m})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700",children:"Category"}),e.jsxs("select",{id:"category",value:t,onChange:n=>p(n.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500",children:[e.jsx("option",{value:"food",children:"Food & Drinks"}),e.jsx("option",{value:"service",children:"Service"}),e.jsx("option",{value:"system",children:"App/Website"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"comment",className:"block text-sm font-medium text-gray-700",children:l==="feedback"?"Comments":"Describe the issue"}),e.jsx("textarea",{id:"comment",value:g,onChange:n=>y(n.target.value),rows:4,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500",placeholder:l==="feedback"?"Tell us more about your experience...":"Please describe the issue in detail..."})]}),e.jsxs(b,{type:"submit",disabled:v,className:`w-full ${l==="issue"?"bg-red-600 hover:bg-red-700":""}`,children:[v?e.jsx(O,{className:"mr-2 h-4 w-4 animate-spin"}):l==="issue"?e.jsx(B,{className:"mr-2 h-4 w-4"}):e.jsx(Ie,{className:"mr-2 h-4 w-4"}),v?"Submitting...":l==="issue"?"Report Issue":"Submit Feedback"]})]})]})})]})},ie=()=>e.jsx(S,{className:"animate-pulse",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex-grow space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"h-4 w-1/3 rounded bg-gray-300"}),e.jsx("div",{className:"h-5 w-1/4 rounded-full bg-gray-300"})]}),e.jsx("div",{className:"h-3 w-1/4 rounded bg-gray-300"}),e.jsx("div",{className:"h-4 w-1/2 rounded bg-gray-300"})]}),e.jsxs("div",{className:"flex-shrink-0 space-y-2 text-right sm:ml-4",children:[e.jsx("div",{className:"h-8 w-24 rounded bg-gray-300 ml-auto"}),e.jsx("div",{className:"h-8 w-28 rounded-full bg-gray-300 ml-auto"})]})]})}),ds=()=>{const{currentUser:s,updateUserProfile:l,updateUserPhoto:d}=ce(),{orderHistory:i,isHistoryLoading:m}=Ne(),[t,p]=r.useState(null),[g,y]=r.useState("overview"),[v,h]=r.useState(!1),[f,u]=r.useState(!1),[c,C]=r.useState(null),[x,P]=r.useState(null),[j,N]=r.useState(!1),T=r.useRef(null),{showToast:R,addToCart:n}=H();r.useEffect(()=>{p(s)},[s]),r.useEffect(()=>{if(!c){P(null);return}const o=URL.createObjectURL(c);return P(o),()=>URL.revokeObjectURL(o)},[c]);const w=r.useMemo(()=>t?we.find(o=>o.id==="cb-01"):null,[t]),F=o=>{t&&l&&(l(o),h(!1))},I=o=>{t&&p(M=>M?{...M,preferences:{...M.preferences,...o}}:null)},E=o=>{if(o.target.files&&o.target.files[0]){if(o.target.files[0].size>2*1024*1024){R("File size should not exceed 2MB.");return}C(o.target.files[0])}},a=()=>{if(!c||!t||!d)return;N(!0);const o=new FileReader;o.readAsDataURL(c),o.onloadend=async()=>{const M=o.result;try{await d(M),N(!1),u(!1),C(null),R("Profile photo updated!")}catch(ue){console.error("Error updating photo:",ue),R("Failed to update photo."),N(!1)}}},k=()=>{w&&n(w,w.sizes[0])};if(!t)return e.jsx("div",{className:"flex h-screen items-center justify-center bg-gray-50",children:e.jsx(O,{className:"h-12 w-12 animate-spin text-primary-600"})});const A=[{id:"overview",label:"Overview",Icon:J},{id:"orders",label:"Order History",Icon:K},{id:"feedback",label:"My Feedback",Icon:he},{id:"settings",label:"Settings",Icon:Ae}],q=()=>{switch(g){case"orders":return m?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((o,M)=>e.jsx(ie,{},M))}):e.jsx(le,{orders:i});case"settings":return e.jsx(Be,{preferences:t.preferences,onUpdatePreferences:I});case"feedback":return e.jsx(Ge,{user:t});case"overview":default:return e.jsxs("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-8 lg:col-span-2",children:[v?e.jsx(qe,{user:t,onSave:F,onCancel:()=>h(!1)}):e.jsxs(S,{className:"overflow-hidden border-none shadow-md transition-shadow hover:shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 pb-4 mb-4",children:[e.jsx("h3",{className:"font-display text-xl font-bold text-gray-900",children:"Personal Information"}),e.jsxs(b,{variant:"ghost",size:"sm",onClick:()=>h(!0),className:"text-primary-600 hover:bg-primary-50",children:[e.jsx(Me,{className:"mr-2 h-4 w-4"})," Edit"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-blue-100 text-blue-600",children:e.jsx(L,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase",children:"Email Address"}),e.jsx("p",{className:"text-gray-900 font-medium",children:t.email})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-purple-100 text-purple-600",children:e.jsx(ne,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase",children:"Phone Number"}),e.jsx("p",{className:"text-gray-900 font-medium",children:t.phone||"Not provided"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-orange-100 text-orange-600",children:e.jsx(me,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase",children:"Member Since"}),e.jsx("p",{className:"text-gray-900 font-medium",children:Q(t.createdAt,"MMMM dd, yyyy")})]})]})]})]}),m?e.jsxs(S,{className:"border-none shadow-md",children:[e.jsx("h3",{className:"font-display text-xl font-bold text-gray-900 mb-4",children:"Recent Orders"}),e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((o,M)=>e.jsx(ie,{},M))})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-display text-xl font-bold text-gray-900",children:"Recent Orders"}),e.jsx(b,{variant:"link",onClick:()=>y("orders"),className:"text-primary-600",children:"View All"})]}),e.jsx(le,{orders:i,limit:3,showViewAll:!1})]})]}),e.jsxs("div",{className:"space-y-8 lg:col-span-1",children:[e.jsxs(S,{className:`border-none shadow-md text-white overflow-hidden relative ${t.tier==="gold"?"bg-gradient-to-br from-yellow-500 to-yellow-700":t.tier==="silver"?"bg-gradient-to-br from-gray-400 to-gray-600":"bg-gradient-to-br from-orange-400 to-orange-600"}`,children:[e.jsx("div",{className:"absolute top-0 right-0 -mt-4 -mr-4 h-24 w-24 rounded-full bg-white opacity-10 blur-xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 -mb-4 -ml-4 h-24 w-24 rounded-full bg-black opacity-10 blur-xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm font-medium uppercase tracking-wider",children:"Current Tier"}),e.jsxs("h3",{className:"font-display text-2xl font-bold capitalize",children:[t.tier," Member"]})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-white/20 flex items-center justify-center backdrop-blur-sm",children:e.jsx(de,{className:"h-6 w-6 text-white",fill:"currentColor"})})]}),e.jsxs("div",{className:"mb-2 flex justify-between items-end",children:[e.jsx("span",{className:"text-3xl font-bold",children:t.currentPoints}),e.jsx("span",{className:"text-sm text-white/80 mb-1",children:"points earned"})]}),e.jsx("div",{className:"w-full bg-black/20 rounded-full h-2 mb-4",children:e.jsx("div",{className:"bg-white h-2 rounded-full transition-all duration-500 shadow-[0_0_10px_rgba(255,255,255,0.5)]",style:{width:`${Math.min(t.currentPoints%1e3/10,100)}%`}})}),e.jsx("p",{className:"text-sm text-white/90",children:t.tier==="gold"?"You are at the highest tier! Enjoy your exclusive benefits.":`Earn ${1e3-t.currentPoints%1e3} more points to reach ${t.tier==="bronze"?"Silver":"Gold"} tier.`})]})]}),w&&e.jsxs(S,{className:"border-none shadow-md transition-shadow hover:shadow-lg overflow-hidden group",children:[e.jsx("h3",{className:"font-display text-xl font-bold text-gray-900 mb-4",children:"Your Favorite"}),e.jsxs("div",{className:"relative aspect-square w-full overflow-hidden rounded-xl mb-4",children:[e.jsx("img",{src:w.imageUrl,alt:w.name,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex flex-col justify-end p-4",children:[e.jsx("p",{className:"font-bold text-white text-lg",children:w.name}),e.jsx("p",{className:"text-white/80 text-sm",children:w.category})]})]}),e.jsxs(b,{className:"w-full rounded-xl py-3 font-bold shadow-lg shadow-primary-600/20",onClick:k,children:["Order Again ",e.jsx(K,{className:"ml-2 h-4 w-4"})]})]})]})]})}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(ve,{}),e.jsxs("main",{children:[e.jsx(He,{user:t,onEditPhoto:()=>u(!0)}),e.jsx("div",{className:"sticky top-16 z-30 border-b border-gray-200 bg-white/95 backdrop-blur-sm sm:top-20",children:e.jsx("div",{className:"container mx-auto max-w-7xl px-4 sm:px-6",children:e.jsx("nav",{className:"-mb-px flex space-x-6 overflow-x-auto py-4 no-scrollbar",children:A.map(o=>e.jsxs("button",{onClick:()=>y(o.id),className:`group inline-flex shrink-0 items-center gap-2 rounded-full px-4 py-2 text-sm font-medium transition-all ${g===o.id?"bg-primary-600 text-white shadow-md":"bg-transparent text-gray-500 hover:bg-gray-100 hover:text-gray-900"}`,children:[e.jsx(o.Icon,{className:`h-4 w-4 ${g===o.id?"text-white":"text-gray-400 group-hover:text-gray-600"}`}),o.label]},o.id))})})}),e.jsx("div",{className:"container mx-auto max-w-7xl p-6",children:q()})]}),e.jsx(ke,{}),e.jsx(X,{isOpen:f,onClose:()=>u(!1),title:"Upload New Photo",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"file",ref:T,onChange:E,accept:"image/*",className:"hidden"}),e.jsx("div",{className:"flex cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-6 text-center transition hover:bg-gray-100",onClick:()=>{var o;return(o=T.current)==null?void 0:o.click()},children:x?e.jsx("img",{src:x,alt:"Preview",className:"h-32 w-32 rounded-full object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-12 w-12 text-gray-400"}),e.jsx("span",{className:"mt-2 block text-sm font-semibold text-gray-600",children:"Click to upload"}),e.jsx("span",{className:"mt-1 block text-xs text-gray-500",children:"PNG or JPG (MAX. 2MB)"})]})}),j&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-primary-600 h-2.5 rounded-full animate-pulse",style:{width:"100%"}})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(b,{variant:"ghost",onClick:()=>u(!1),children:"Cancel"}),e.jsxs(b,{onClick:a,disabled:!c||j,children:[j?e.jsx(O,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Upload Photo"]})]})]})})]})};export{ds as default};
