import{r,d as R,t as T,j as e,N as O,l as I,K as F,I as $}from"./index-C0udEWay.js";import{f as q}from"./seedCustomizationOptions-8x4KZtbH.js";import{m as v}from"./mockCustomizationOptions-CwPUP-Xn.js";const A=()=>{const[a,n]=r.useState([]),[l,c]=r.useState(!0),[x,p]=r.useState(null);return r.useEffect(()=>{(async()=>{try{c(!0);const h=await R.collection("ingredients").where("isTopping","==",!0).get(),d=[];h.forEach(f=>{const t=f.data();t.stock>0&&t.toppingPrice!==void 0&&t.portionSize!==void 0&&d.push({id:f.id,name:t.name,price:t.toppingPrice,stock:t.stock,portionSize:t.portionSize})}),d.sort((f,t)=>f.name.localeCompare(t.name)),n(d),p(null)}catch(o){console.error("Error fetching toppings:",o),p("Failed to load toppings"),n([{id:"pearls",name:"Pearls",price:10,stock:3e3,portionSize:30},{id:"pudding",name:"Pudding",price:15,stock:2e3,portionSize:40},{id:"grass-jelly",name:"Grass Jelly",price:15,stock:2500,portionSize:35}])}finally{c(!1)}})()},[]),{toppings:a,isLoading:l,error:x}},G=()=>{const[a,n]=r.useState(v),[l,c]=r.useState(!0),[x,p]=r.useState(null);return r.useEffect(()=>{(async()=>{try{c(!0);const o=await q();o&&o.sugarLevels&&o.iceLevels?(n(o),p(null)):n(v)}catch(o){console.error("Error fetching customization options:",o),p("Failed to load customization options"),n(v)}finally{c(!1)}})()},[]),{options:a,isLoading:l,error:x}},U=({product:a,selectedSize:n,isOpen:l,onClose:c,onConfirm:x,onBuyNow:p,initialCustomizations:i,initialQuantity:o=1})=>{const[h,d]=r.useState("100%"),[f,t]=r.useState("Normal"),[u,b]=r.useState("None"),[m,y]=r.useState(1),{toppings:k,isLoading:C}=A(),{options:N,isLoading:E}=G();T.useEffect(()=>{if(l){if(i){d(i.sugarLevel||"100%"),t(i.iceLevel||"Normal");const s=i.toppings&&i.toppings.length>0?i.toppings[0]:"None";b(s)}else d("100%"),t("Normal"),b("None");y(o)}},[l,i,o]);const P=()=>{const s=["Coffee Based","Non-Coffee Based","Matcha Series","Refreshments"].includes(a.category),g={toppings:u!=="None"?[u]:[]};return s&&(g.sugarLevel=h,g.iceLevel=f),g},B=()=>{x(P(),m,L/m),c()},w=[{id:"none",name:"None",price:0},...k.map(s=>({id:s.id,name:s.name,price:s.price}))],j=w.find(s=>s.name===u),z=(j==null?void 0:j.price)||0,L=(n.price+z)*m,S=C||E,M=e.jsxs("button",{onClick:B,disabled:S,className:"w-full flex items-center justify-between rounded-xl bg-gradient-to-r from-coffee-600 to-coffee-700 px-6 py-3.5 text-white font-bold shadow-lg hover:shadow-xl hover:scale-[1.01] active:scale-[0.99] transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{children:"Add to Order"}),e.jsxs("span",{className:"text-lg tabular-nums",children:["₱",L.toFixed(2)]})]});return e.jsx(O,{isOpen:l,onClose:c,title:a.name,footer:M,className:"sm:max-w-lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b border-gray-100",children:[e.jsx("div",{className:"h-20 w-20 shrink-0 rounded-xl overflow-hidden bg-gray-100 border border-gray-200",children:e.jsx("img",{src:a.imageUrl,alt:a.name,className:"h-full w-full object-cover"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 mb-1",children:[e.jsx("span",{className:"bg-gray-100 px-2 py-0.5 rounded font-medium text-gray-700",children:n.name}),e.jsx("span",{children:n.size})]}),e.jsx("p",{className:"text-sm text-gray-500 line-clamp-2",children:a.description})]})]}),S?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-coffee-600"})}):e.jsxs(e.Fragment,{children:[["Coffee Based","Non-Coffee Based","Matcha Series","Refreshments"].includes(a.category)&&e.jsxs("div",{children:[e.jsx("h4",{className:"mb-3 text-sm font-bold text-gray-900 uppercase tracking-wide flex items-center gap-2",children:"Sugar Level"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.sugarLevels.map(s=>e.jsx("button",{onClick:()=>d(s.value),className:`flex-1 min-w-[60px] rounded-lg py-2 text-sm font-semibold transition-all border ${h===s.value?"bg-coffee-600 text-white border-coffee-600 shadow-md":"bg-white text-gray-600 border-gray-200 hover:border-coffee-300 hover:bg-coffee-50"}`,children:s.value},s.value))})]}),["Coffee Based","Non-Coffee Based","Matcha Series","Refreshments"].includes(a.category)&&e.jsxs("div",{children:[e.jsx("h4",{className:"mb-3 text-sm font-bold text-gray-900 uppercase tracking-wide flex items-center gap-2",children:"Ice Level"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.iceLevels.map(s=>e.jsx("button",{onClick:()=>t(s.value),className:`flex-1 min-w-[60px] rounded-lg py-2 text-sm font-semibold transition-all border ${f===s.value?"bg-coffee-600 text-white border-coffee-600 shadow-md":"bg-white text-gray-600 border-gray-200 hover:border-coffee-300 hover:bg-coffee-50"}`,children:s.value},s.value))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"mb-3 text-sm font-bold text-gray-900 uppercase tracking-wide flex items-center justify-between",children:[e.jsx("span",{children:"Toppings"}),e.jsx("span",{className:"text-xs font-normal text-gray-500 normal-case",children:"Select one"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(s=>{const g=u===s.name;return e.jsxs("button",{onClick:()=>b(s.name),className:`
                                                relative px-3 py-2 rounded-lg text-sm font-medium transition-all border flex items-center gap-2
                                                ${g?"bg-coffee-50 border-coffee-600 text-coffee-700 shadow-sm ring-1 ring-coffee-600":"bg-white border-gray-200 text-gray-600 hover:border-coffee-300 hover:bg-gray-50"}
                                            `,children:[e.jsx("span",{children:s.name}),s.price>0&&e.jsxs("span",{className:`text-xs font-bold ${g?"text-coffee-600":"text-gray-400"}`,children:["+₱",s.price]})]},s.id)})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:[e.jsx("span",{className:"font-bold text-gray-900",children:"Quantity"}),e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 rounded-lg p-1 border border-gray-200",children:[e.jsx("button",{onClick:()=>y(Math.max(1,m-1)),className:"h-8 w-8 rounded-md bg-white shadow-sm flex items-center justify-center text-gray-600 hover:text-coffee-600 disabled:opacity-50 transition-colors",disabled:m<=1,children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-8 text-center font-bold text-gray-900 tabular-nums",children:m}),e.jsx("button",{onClick:()=>y(m+1),className:"h-8 w-8 rounded-md bg-coffee-600 shadow-sm flex items-center justify-center text-white hover:bg-coffee-700 transition-colors",children:e.jsx($,{className:"h-4 w-4"})})]})]})]})]})})};export{U as P};
