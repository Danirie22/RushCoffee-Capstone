import{c as M,j as e,B as C,o as D,r as l,h as O,X as G,C as Y,f as H,n as K,u as W,s as J,H as S,F,U as Q,P as V,l as I}from"./index-C0udEWay.js";import{W as X}from"./wallet-DkztIqRo.js";import{B as Z}from"./banknote-h7-GGd5P.js";import{S as ee}from"./shopping-bag-DNX2AFCT.js";import{M as se}from"./message-square-BXYaspwu.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],ae=M("cloud-upload",te);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],le=M("file-image",re),ce=({selectedMethod:o,onSelectMethod:d})=>{const t=o==="gcash",c=o==="cash",r=({isSelected:a})=>e.jsx("div",{className:`absolute top-4 right-4 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full border-2 transition-all ${a?"border-primary-600 bg-primary-600":"border-gray-400 bg-white"}`,children:a&&e.jsx(D,{className:"h-4 w-4 text-white"})});return e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"mb-4 font-display text-xl font-bold text-coffee-900",children:"Payment Method"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",role:"radiogroup",children:[e.jsxs("div",{onClick:()=>d("gcash"),role:"radio","aria-checked":t,tabIndex:0,onKeyDown:a=>(a.key===" "||a.key==="Enter")&&d("gcash"),className:`relative cursor-pointer rounded-xl border-2 p-6 transition-all duration-200 ease-in-out hover:border-primary-300 ${t?"border-primary-600 bg-primary-50 shadow-lg":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-lg bg-blue-100",children:e.jsx(X,{className:"h-7 w-7 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"pr-8 font-display text-lg font-bold text-coffee-900",children:"GCash"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Pay securely via GCash QR code."})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(C,{className:t?"bg-blue-200 text-blue-800":"bg-gray-100 text-gray-700",children:"Instant confirmation"})}),e.jsx(r,{isSelected:t})]}),e.jsxs("div",{onClick:()=>d("cash"),role:"radio","aria-checked":c,tabIndex:0,onKeyDown:a=>(a.key===" "||a.key==="Enter")&&d("cash"),className:`relative cursor-pointer rounded-xl border-2 p-6 transition-all duration-200 ease-in-out hover:border-primary-300 ${c?"border-primary-600 bg-primary-50 shadow-lg":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-lg bg-green-100",children:e.jsx(Z,{className:"h-7 w-7 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"pr-8 font-display text-lg font-bold text-coffee-900",children:"Over the counter payment"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Pay when you collect your order."})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(C,{className:c?"bg-green-200 text-green-800":"bg-gray-100 text-gray-700",children:"Pay at counter"})}),e.jsx(r,{isSelected:c})]})]})]})},oe=({totalAmount:o,orderNumber:d,receipt:t,onReceiptUpload:c})=>{const[r,a]=l.useState(null);l.useEffect(()=>{if(!t){a(null);return}const m=URL.createObjectURL(t);return a(m),()=>URL.revokeObjectURL(m)},[t]);const n=m=>{m.target.files&&m.target.files[0]&&c(m.target.files[0]),m.target.value=""},w=()=>{c(null)};return e.jsxs("div",{className:"w-full max-w-md mx-auto space-y-6",children:[e.jsx("div",{className:"rounded-lg border-l-4 border-blue-400 bg-blue-50 p-4",role:"alert",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(O,{className:"h-5 w-5 text-blue-400","aria-hidden":"true"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-blue-700",children:"Please scan the QR code, complete the payment, and upload a screenshot of your receipt."})})]})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex h-64 w-64 items-center justify-center rounded-xl border-4 border-primary-600 bg-white p-4 shadow-lg",children:e.jsx("div",{className:"relative flex h-full w-full items-center justify-center bg-[radial-gradient(#1e1612_1px,transparent_1px),radial-gradient(#1e1612_1px,transparent_1px)] bg-[length:12px_12px] bg-[position:0_0,6px_6px]",children:e.jsx("div",{className:"bg-white p-2 font-mono text-sm font-bold text-coffee-900",children:d})})}),e.jsxs("p",{className:"mt-4 text-sm font-medium text-gray-600",children:["Merchant: ",e.jsx("span",{className:"font-bold text-coffee-900",children:"Rush Coffee"})]}),e.jsxs("p",{className:"font-display text-3xl font-bold text-primary-600",children:["₱",o.toFixed(2)]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("input",{type:"file",id:"receipt-upload",className:"hidden",accept:"image/*",onChange:n}),t?e.jsxs("div",{className:"relative rounded-lg border border-gray-300 bg-white p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[r?e.jsx("img",{src:r,alt:"Receipt preview",className:"h-16 w-16 flex-shrink-0 rounded-md object-cover"}):e.jsx("div",{className:"flex h-16 w-16 flex-shrink-0 items-center justify-center rounded-md bg-gray-100",children:e.jsx(le,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx("p",{className:"truncate text-sm font-medium text-gray-800",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(t.size/1024).toFixed(2)," KB"]})]})]}),e.jsx("button",{onClick:w,className:"absolute -top-2 -right-2 flex h-6 w-6 items-center justify-center rounded-full bg-red-500 text-white transition-transform hover:scale-110","aria-label":"Remove receipt",children:e.jsx(G,{className:"h-4 w-4"})})]}):e.jsxs("label",{htmlFor:"receipt-upload",className:"flex cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-6 text-center transition hover:bg-gray-100",children:[e.jsx(ae,{className:"h-12 w-12 text-gray-400"}),e.jsx("span",{className:"mt-2 block text-sm font-semibold text-gray-600",children:"Upload Receipt"}),e.jsx("span",{className:"mt-1 block text-xs text-gray-500",children:"PNG, JPG, GIF up to 10MB"})]})]})]})},ne=({items:o,subtotal:d,serviceFee:t=0,total:c})=>e.jsx("div",{className:"w-full lg:sticky lg:top-24",children:e.jsxs(Y,{className:"rounded-xl border-gray-200 p-6 shadow-none",children:[e.jsx("h2",{className:"mb-4 font-display text-lg font-semibold text-coffee-900",children:"Order Summary"}),e.jsx("div",{className:"max-h-80 space-y-3 overflow-y-auto pr-2",children:o.map((r,a)=>e.jsxs("div",{className:"flex items-center gap-3 rounded-lg bg-gray-50 p-2",children:[r.imageUrl&&e.jsx("div",{className:"h-14 w-14 shrink-0 overflow-hidden rounded-lg bg-white border border-gray-200",children:e.jsx("img",{src:r.imageUrl,alt:r.productName,className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:r.productName}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-500",children:["×",r.quantity]}),e.jsxs("span",{className:"text-sm font-bold text-coffee-700",children:["₱",(r.price*r.quantity).toFixed(2)]})]})]})]},a))}),e.jsx("hr",{className:"my-4 border-gray-200"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["₱",d.toFixed(2)]})]}),t>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Service Fee"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["₱",t.toFixed(2)]})]})]}),e.jsx("hr",{className:"my-4 border-dashed border-gray-300"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-base font-bold text-gray-900",children:"Total"}),e.jsxs("span",{className:"font-display text-2xl font-bold text-primary-600",children:["₱",c.toFixed(2)]})]})]})}),ue=()=>{const o=H(),{cartItems:d,showToast:t,totalCartItems:c,clearCart:r,selectedItemIds:a}=K(),{currentUser:n}=W(),{setActiveOrder:w,addOrderToHistory:m}=J(),p=l.useMemo(()=>d.filter(s=>a.includes(s.id)),[d,a]),[x,R]=l.useState(null),[h,b]=l.useState({name:"",phone:""}),[U,$]=l.useState(""),[u,z]=l.useState({}),[j,q]=l.useState(null),[f,k]=l.useState(!1),[N,_]=l.useState(!1),{subtotal:E,serviceFee:A,total:y}=l.useMemo(()=>{const s=p.reduce((v,i)=>v+i.selectedSize.price*i.quantity,0),g=15;return{subtotal:s,serviceFee:g,total:s+g}},[p]),B=l.useMemo(()=>p.map(s=>({productName:`${s.product.name} (${s.selectedSize.name})`,quantity:s.quantity,price:s.selectedSize.price,imageUrl:s.product.imageUrl})),[p]);l.useEffect(()=>{if(!n){t("Please log in to proceed to checkout."),o("/auth/login",{state:{from:"/checkout"}});return}c===0&&!f&&!N&&(t("Your cart is empty. Add items to checkout."),o("/menu"))},[c,o,t,f,N,n]),l.useEffect(()=>{n&&b({name:`${n.firstName} ${n.lastName}`,phone:n.phone||""})},[n]);const L=()=>{const s={};return h.name.trim().length<2&&(s.name="Name must be at least 2 characters long."),/^(09|\+639)\d{9}$/.test(h.phone)||(s.phone="Please enter a valid Philippine phone number (e.g., 09xxxxxxxxx)."),x||(s.payment="Please select a payment method."),x==="gcash"&&!j&&(s.gcash="Please upload your payment receipt to proceed."),z(s),Object.keys(s).length===0},T=async s=>{if(s.preventDefault(),!n||!L()){t("Please correct the errors before proceeding.");return}k(!0);const g=`RC-2025-${Math.floor(1e3+Math.random()*9e3)}`;setTimeout(async()=>{const v={userId:n.uid,customerName:h.name,orderNumber:g,position:Math.floor(Math.random()*5)+1,status:"waiting",orderItems:p.map(i=>({productId:i.product.id,productName:`${i.product.name} (${i.selectedSize.name})`,quantity:i.quantity,price:i.selectedSize.price,size:i.selectedSize.name,category:i.product.category,customizations:i.customizations})),totalAmount:y,paymentMethod:x,paymentStatus:x==="gcash"?"paid":"pending",estimatedTime:10,orderType:"online"};await m(v),r(),k(!1),_(!0),o("/queue",{state:{fromCheckout:!0,orderNumber:g}})},2e3)},P=f||!x||!h.name||!/^(09|\+639)\d{9}$/.test(h.phone)||x==="gcash"&&!j;return!n||c===0&&!N?e.jsxs("div",{className:"flex min-h-screen flex-col",children:[e.jsx(S,{}),e.jsx("main",{className:"flex flex-1 items-center justify-center bg-gray-50 text-center",children:e.jsxs("div",{children:[e.jsx(ee,{className:"mx-auto h-24 w-24 text-gray-300"}),e.jsx("h1",{className:"mt-4 text-2xl font-bold text-gray-800",children:"Your cart is empty"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Add some delicious coffee to get started."}),e.jsx("button",{onClick:()=>o("/menu"),className:"mt-6 rounded-full bg-primary-600 px-6 py-2 font-semibold text-white hover:bg-primary-700",children:"Browse Menu"})]})}),e.jsx(F,{})]}):e.jsxs("div",{className:"flex min-h-screen flex-col bg-gray-50",children:[e.jsx(S,{}),e.jsxs("main",{className:"container mx-auto max-w-7xl px-4 py-8",children:[e.jsx("h1",{className:"mb-6 font-display text-3xl font-bold text-coffee-900",children:"Checkout"}),e.jsxs("form",{onSubmit:T,id:"checkout-form",className:"grid grid-cols-1 gap-8 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-8 lg:col-span-2",children:[e.jsxs("div",{className:"rounded-xl border bg-white p-6",children:[e.jsx("h2",{className:"mb-4 font-display text-xl font-bold text-coffee-900",children:"Your Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Full Name"}),e.jsx(Q,{className:"absolute left-3 top-10 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",id:"name",value:h.name,onChange:s=>b({...h,name:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 py-2 pl-10 shadow-sm focus:border-primary-500 focus:ring-primary-500",placeholder:"Juan dela Cruz"}),u.name&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:u.name})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsx(V,{className:"absolute left-3 top-10 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"tel",id:"phone",value:h.phone,onChange:s=>b({...h,phone:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 py-2 pl-10 shadow-sm focus:border-primary-500 focus:ring-primary-500",placeholder:"09171234567"}),u.phone&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:u.phone})]})]})]}),e.jsxs("div",{className:"rounded-xl border bg-white p-6",children:[e.jsx(ce,{selectedMethod:x,onSelectMethod:R}),u.payment&&e.jsx("p",{className:"mt-2 text-xs text-red-500",children:u.payment}),x==="gcash"&&e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsx(oe,{totalAmount:y,orderNumber:`TEMP-${Date.now()}`,receipt:j,onReceiptUpload:q}),u.gcash&&e.jsx("p",{className:"mt-2 text-xs text-red-500 text-center",children:u.gcash})]}),x==="cash"&&e.jsx("div",{className:"mt-6 rounded-lg border-l-4 border-green-400 bg-green-50 p-4",role:"alert",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(O,{className:"h-5 w-5 text-green-400"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-green-700",children:"Please prepare the exact amount. You can pay at the counter upon pickup."})})]})})]}),e.jsxs("div",{className:"rounded-xl border bg-white p-6",children:[e.jsx("h2",{className:"mb-4 font-display text-xl font-bold text-coffee-900",children:"Special Instructions (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),e.jsx("textarea",{id:"notes",value:U,onChange:s=>$(s.target.value),rows:3,className:"block w-full rounded-md border-gray-300 py-2 pl-10 shadow-sm focus:border-primary-500 focus:ring-primary-500",placeholder:"e.g., less ice, extra shot..."})]})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx("button",{type:"submit",form:"checkout-form",disabled:P,className:"mt-2 flex w-full max-w-xs justify-center rounded-full bg-primary-600 px-4 py-3 text-base font-semibold text-white shadow-sm transition-colors hover:bg-primary-700 disabled:cursor-not-allowed disabled:bg-primary-400",children:f?e.jsx(I,{className:"h-6 w-6 animate-spin"}):"Place Order"})})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(ne,{items:B,subtotal:E,serviceFee:A,total:y})})]})]}),e.jsx("div",{className:"sticky bottom-0 left-0 right-0 border-t border-gray-200 bg-white/90 p-4 backdrop-blur-sm lg:hidden",children:e.jsx("button",{type:"submit",form:"checkout-form",disabled:P,className:"flex w-full justify-center rounded-full bg-primary-600 px-4 py-3 text-base font-semibold text-white shadow-sm transition-colors hover:bg-primary-700 disabled:cursor-not-allowed disabled:bg-primary-400",children:f?e.jsx(I,{className:"h-6 w-6 animate-spin"}):`Place Order (₱${y.toFixed(2)})`})}),e.jsx(F,{})]})};export{ue as default};
