import{d as p,aj as f,y as d,J as $}from"./index-Ymay8exD.js";const I=async m=>{try{const n=p.batch(),s=p.collection("ingredients");for(const r of m){console.log(`ğŸ”„ Processing item: ${r.productName} (ID: ${r.productId})`);const{quantity:o,customizations:i}=r;if(i!=null&&i.sugarLevel){const e=f.sugarLevels.find(c=>c.value===i.sugarLevel);if(e&&e.sugarAmount>0){const c=s.doc(e.sugarIngredientId),t=e.sugarAmount*o;n.update(c,{stock:d.firestore.FieldValue.increment(-t)}),console.log(`Deducting ${t}ml of ${e.sugarIngredientId} for ${r.productName}`)}}if(i!=null&&i.iceLevel){const e=f.iceLevels.find(c=>c.value===i.iceLevel);if(e&&e.iceAmount>0){const c=s.doc(e.iceIngredientId),t=e.iceAmount*o;n.update(c,{stock:d.firestore.FieldValue.increment(-t)}),console.log(`Deducting ${t}g of ${e.iceIngredientId} for ${r.productName}`)}}if(i!=null&&i.toppings&&i.toppings.length>0)for(const e of i.toppings){const c=await s.where("name","==",e).where("isTopping","==",!0).limit(1).get();if(c.empty)console.warn(`Topping "${e}" not found in inventory`);else{const t=c.docs[0],g=(t.data().portionSize||30)*o;n.update(t.ref,{stock:d.firestore.FieldValue.increment(-g)}),console.log(`Deducting ${g}g of ${e} for ${r.productName}`)}}const a=$.find(e=>e.id===r.productId);if(a){if(console.log(`ğŸ” Found product for deduction: ${a.name} (Recipe: ${a.recipe?a.recipe.length:0} items)`),a.recipe)for(const t of a.recipe){const u=s.doc(t.ingredientId),l=t.quantity*o;n.update(u,{stock:d.firestore.FieldValue.increment(-l)}),console.log(`ğŸ“‰ Deducting ${l} of ${t.ingredientId} for ${r.productName} (Qty: ${o})`)}else console.warn(`âš ï¸ Product ${a.name} has no recipe defined.`);const e=["Coffee Based","Non-Coffee Based","Matcha Series","Refreshments"].includes(a.category),c=["Meals"].includes(a.category);if(e&&r.size){const t=r.size.toLowerCase();let u="",l="";t==="grande"?(u="cup-grande",l="lid-grande"):t==="venti"&&(u="cup-venti",l="lid-venti"),u&&(n.update(s.doc(u),{stock:d.firestore.FieldValue.increment(-o)}),console.log(`ğŸ¥¤ Deducting ${o} ${u}`)),l&&(n.update(s.doc(l),{stock:d.firestore.FieldValue.increment(-o)}),console.log(`ğŸ¥¤ Deducting ${o} ${l}`)),n.update(s.doc("straw"),{stock:d.firestore.FieldValue.increment(-o)}),console.log(`ğŸ¥¤ Deducting ${o} straw`),n.update(s.doc("napkins"),{stock:d.firestore.FieldValue.increment(-(o*2))}),console.log(`ğŸ§» Deducting ${o*2} napkins (beverage)`)}c&&(n.update(s.doc("takeout-pack"),{stock:d.firestore.FieldValue.increment(-o)}),console.log(`ğŸ¥¡ Deducting ${o} takeout-pack`),n.update(s.doc("napkins"),{stock:d.firestore.FieldValue.increment(-(o*2))}),console.log(`ğŸ§» Deducting ${o*2} napkins (meal)`))}else console.error(`âŒ Product not found in mockProducts: ${r.productId}`)}await n.commit(),console.log("âœ… Inventory deducted successfully for order")}catch(n){throw console.error("âŒ Error deducting inventory:",n),n}};export{I as d};
