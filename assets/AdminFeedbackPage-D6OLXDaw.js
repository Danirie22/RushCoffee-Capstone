import{c as B,j as e,B as D,h as C,r as l,Q as L,l as $,$ as U,d as N,y as V,q as T,ag as _,a as M,ah as H,g as J}from"./index-hoivcvTL.js";import{f as O,S as F}from"./StarRating-B2mGYaQ1.js";import{M as R}from"./message-square-CQmPlm4-.js";import{B as k}from"./Button-9eR8SiQT.js";import{S as P}from"./star-BUIo-gao.js";import{F as Q}from"./funnel-CG95gBKf.js";import"./en-US-wfBU2YNu.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M14 7a4 4 0 0 1 4 4v3a6 6 0 0 1-12 0v-3a4 4 0 0 1 4-4z",key:"uouzyp"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M21 21a4 4 0 0 0-3.81-4",key:"1b0z45"}],["path",{d:"M21 5a4 4 0 0 1-3.55 3.97",key:"5cxbf6"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M3 21a4 4 0 0 1 3.81-4",key:"1fjd4g"}],["path",{d:"M3 5a4 4 0 0 0 3.55 3.97",key:"1d7oge"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M9 7.13V6a3 3 0 1 1 6 0v1.13",key:"1vgav8"}]],Y=B("bug",W),G={pending:"bg-yellow-100 text-yellow-800 border-yellow-200",published:"bg-blue-100 text-blue-800 border-blue-200",resolved:"bg-green-100 text-green-800 border-green-200"},K=({feedback:s,onRespond:d})=>{const r=s.user?`${s.user.firstName} ${s.user.lastName}`:`User ${s.userId.substring(0,6)}`,a=s.rating===0;return e.jsxs("div",{className:`flex flex-col rounded-xl border bg-white p-5 shadow-sm transition-all hover:shadow-md group ${a?"border-l-4 border-l-red-500":"border-gray-100"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center text-sm font-bold ${a?"bg-red-50 text-red-600":"bg-gray-100 text-gray-600"}`,children:a?e.jsx(Y,{className:"h-5 w-5"}):r.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800 text-sm",children:r}),e.jsx("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:s.createdAt?O(s.createdAt,{addSuffix:!0}):"Just now"})]})]}),e.jsx(D,{className:`capitalize border ${G[s.status]}`,children:s.status})]}),e.jsxs("div",{className:"mb-3",children:[a?e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-md bg-red-50 px-2.5 py-1 text-xs font-bold text-red-700 ring-1 ring-inset ring-red-600/10",children:[e.jsx(C,{className:"h-3.5 w-3.5"}),"Issue Report"]}),e.jsx("span",{className:"inline-flex items-center gap-1 rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 capitalize",children:s.category})]}):e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(F,{rating:s.rating,readonly:!0,size:"sm"}),e.jsx("span",{className:"text-xs text-gray-400",children:"â€¢"}),e.jsx("span",{className:"text-xs font-medium text-gray-500 capitalize",children:s.category})]}),e.jsxs("div",{className:`rounded-lg p-3 text-sm ${a?"bg-red-50/50 text-gray-800":"bg-gray-50 text-gray-600"}`,children:['"',s.comment,'"']})]}),e.jsx("div",{className:"mt-auto pt-2",children:e.jsxs("button",{onClick:d,className:`w-full flex items-center justify-center gap-2 rounded-lg px-4 py-2.5 text-sm font-semibold transition-colors 
            ${a?"bg-red-600 text-white hover:bg-red-700 shadow-sm":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 hover:text-primary-600"}`,children:[e.jsx(R,{className:"h-4 w-4"}),a?"Resolve Issue":"View & Respond"]})})]})},X=({isOpen:s,onClose:d,feedback:r})=>{const[a,o]=l.useState(r.response||""),[x,n]=l.useState(r.status),[c,h]=l.useState(!1);l.useEffect(()=>{s&&(o(r.response||""),n(r.status))},[s,r]);const y=async i=>{i.preventDefault(),h(!0);try{await N.collection("feedback").doc(r.id).update({response:a,status:x,updatedAt:V.firestore.FieldValue.serverTimestamp()}),d()}catch(u){console.error("Error updating feedback: ",u)}finally{h(!1)}},f=r.user?`${r.user.firstName} ${r.user.lastName}`:`User ID: ${r.userId}`;return e.jsx(L,{isOpen:s,onClose:d,title:`Feedback from ${f}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-500",children:"Rating"}),e.jsx(F,{rating:r.rating,readonly:!0})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-500",children:"Comment"}),e.jsx("p",{className:"mt-1 max-h-40 overflow-y-auto rounded-md bg-gray-50 p-3 text-gray-700 whitespace-pre-wrap",children:r.comment})]}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"response",className:"block text-sm font-medium text-gray-700",children:"Your Response"}),e.jsx("textarea",{id:"response",value:a,onChange:i=>o(i.target.value),rows:4,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500",placeholder:"Write a response to the customer..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Update Status"}),e.jsx("div",{className:"mt-2 flex gap-2 rounded-full bg-gray-100 p-1",children:["pending","published","resolved"].map(i=>e.jsx("button",{type:"button",onClick:()=>n(i),className:`w-full rounded-full py-1.5 text-sm font-semibold capitalize transition-colors ${x===i?"bg-primary-600 text-white shadow":"text-gray-600 hover:bg-primary-50"}`,children:i},i))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(k,{type:"button",variant:"ghost",onClick:d,children:"Cancel"}),e.jsxs(k,{type:"submit",disabled:c,children:[c?e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(U,{className:"mr-2 h-4 w-4"}),"Save Response"]})]})]})]})})},ne=()=>{const[s,d]=l.useState([]),[r,a]=l.useState(!0),[o,x]=l.useState("pending"),[n,c]=l.useState("all"),[h,y]=l.useState(!1),[f,i]=l.useState(null);l.useEffect(()=>{const t=new Map,z=async()=>{if(t.size>0)return t;const g=M(N,"users");return(await J(g)).forEach(p=>{const m=p.data();t.set(p.id,{firstName:m.firstName,lastName:m.lastName,email:m.email})}),t},E=T(M(N,"feedback"),_("createdAt","desc")),q=H(E,async g=>{try{const b=await z(),p=[];g.forEach(m=>{var w,S;const j=m.data();p.push({id:m.id,...j,createdAt:(w=j.createdAt)==null?void 0:w.toDate(),updatedAt:(S=j.updatedAt)==null?void 0:S.toDate(),user:b.get(j.userId)})}),d(p)}catch(b){console.error("Error processing feedback data:",b)}finally{a(!1)}},g=>{console.error("Error fetching feedback: ",g),a(!1)});return()=>q()},[]);const u=l.useMemo(()=>s.filter(t=>!(o!=="all"&&t.status!==o||n==="reviews"&&t.rating===0||n==="reports"&&t.rating>0)),[o,n,s]),v=l.useMemo(()=>({total:s.length,reviews:s.filter(t=>t.rating>0).length,reports:s.filter(t=>t.rating===0).length,pending:s.filter(t=>t.status==="pending").length}),[s]),A=t=>{i(t),y(!0)},I=()=>{y(!1),i(null)};return r?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx($,{className:"h-12 w-12 animate-spin text-primary-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-6 md:flex-row md:items-end md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-display text-3xl font-bold text-gray-800",children:"Feedback & Support"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage customer reviews and resolve reported issues."})]}),e.jsxs("div",{className:"flex p-1 bg-gray-100 rounded-lg self-start md:self-auto",children:[e.jsxs("button",{onClick:()=>c("all"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${n==="all"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:["All (",v.total,")"]}),e.jsxs("button",{onClick:()=>c("reviews"),className:`flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-all ${n==="reviews"?"bg-white text-primary-700 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(P,{className:"h-4 w-4"}),"Reviews (",v.reviews,")"]}),e.jsxs("button",{onClick:()=>c("reports"),className:`flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-all ${n==="reports"?"bg-white text-red-700 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(C,{className:"h-4 w-4"}),"Issues (",v.reports,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-white border border-gray-200 rounded-full text-sm font-medium text-gray-600",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:"Filter Status:"})]}),["pending","published","resolved","all"].map(t=>e.jsx("button",{onClick:()=>x(t),className:`rounded-full px-4 py-1.5 text-sm font-semibold capitalize transition-all border ${o===t?"bg-gray-800 text-white border-gray-800":"bg-white text-gray-600 border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:t},t))]}),u.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:u.map(t=>e.jsx(K,{feedback:t,onRespond:()=>A(t)},t.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-2xl border-2 border-dashed border-gray-200 bg-gray-50/50 p-16 text-center",children:[e.jsx("div",{className:"h-16 w-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(R,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-700",children:"No items found"}),e.jsxs("p",{className:"mt-2 text-gray-500 max-w-sm",children:["There are no ",n==="reports"?"issue reports":n==="reviews"?"reviews":"items",' matching the "',o,'" filter.']}),o!=="all"&&e.jsx("button",{onClick:()=>x("all"),className:"mt-6 text-primary-600 font-semibold hover:text-primary-700",children:"Clear Filters"})]}),f&&e.jsx(X,{isOpen:h,onClose:I,feedback:f})]})};export{ne as default};
