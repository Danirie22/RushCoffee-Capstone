import{r as m,n as L,m as R,a8 as D,d as u,j as e,i as I,C as S,W as U,y as p}from"./index-C5TVgI0f.js";import{D as T}from"./DigitalReceipt-qCVRivDM.js";import{B as $}from"./Button-DRYL9amp.js";import{d as B}from"./inventoryDeduction-0SdqRMpP.js";import{C as F}from"./clock-B42jof9q.js";import{C as P}from"./coffee-BX82asfr.js";import{F as z}from"./file-text-D8hRsqjS.js";const J=()=>{const[j,v]=m.useState([]),[w,A]=m.useState(!0),[f,N]=m.useState(null),{showToast:b}=L(),{products:E}=R(),h=D.useRef(0);m.useEffect(()=>{const t=()=>{new Audio("data:audio/mp3;base64,//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq").play().catch(()=>{}),document.removeEventListener("click",t),document.removeEventListener("touchstart",t)};return document.addEventListener("click",t),document.addEventListener("touchstart",t),()=>{document.removeEventListener("click",t),document.removeEventListener("touchstart",t)}},[]),m.useEffect(()=>{const t=u.collection("orders").orderBy("timestamp","desc").limit(100).onSnapshot(q=>{const c=q.docs.map(o=>{var r;const a=o.data();return{id:o.id,...a,orderItems:a.orderItems||a.items||[],timestamp:(r=a.timestamp)!=null&&r.toDate?a.timestamp.toDate():a.timestamp?new Date(a.timestamp):new Date}});c.length>h.current&&h.current!==0&&new Audio("data:audio/mp3;base64,//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq").play().catch(a=>console.log("Audio play failed:",a)),h.current=c.length,v(c),A(!1)});return()=>t()},[]);const g=async(t,q,c)=>{try{const o={status:q,updatedAt:new Date};if(c&&(o.cancellationReason=c),q==="ready"){const a=await u.collection("orders").doc(t).get();if(a.exists){const r=a.data();if(r!=null&&r.inventoryDeducted)console.log(`â„¹ï¸ Inventory already deducted for order ${t}. Skipping.`);else if(r&&r.orderItems){console.log(`ðŸ“‰ Deducting inventory for order ${t} (Status: Ready)`);try{await B(r.orderItems),o.inventoryDeducted=!0}catch(n){console.error("âš ï¸ Failed to deduct inventory:",n)}}}}if(await u.collection("orders").doc(t).update(o),q==="completed"){const a=await u.collection("orders").doc(t).get();if(a.exists){const r=a.data();if(r&&r.userId){let n=0;const s=r.orderItems||r.items||[],l=[];if(s.forEach(i=>{l.push(i.productName);const d=i.productName.toLowerCase();d.includes("grande")?n+=4*i.quantity:d.includes("venti")?n+=5*i.quantity:d.includes("ala carte")?n+=4*i.quantity:d.includes("combo")&&(n+=5*i.quantity)}),n>0){const i={id:`rh-${Date.now()}`,type:"earned",points:n,description:`Earned from ${l.join(", ")}`,date:new Date};await u.collection("users").doc(r.userId).update({totalOrders:p.firestore.FieldValue.increment(1),currentPoints:p.firestore.FieldValue.increment(n),loyaltyPoints:p.firestore.FieldValue.increment(n),rewardsHistory:p.firestore.FieldValue.arrayUnion(i)}),console.log(`ðŸŒŸ Awarded ${n} points to user ${r.userId}`)}}}}b(`Order updated to ${q}`)}catch(o){console.error("Error updating order status:",o),b("Failed to update order status")}},C=t=>{if(window.confirm("Are you sure you want to cancel this order?")){const q=window.prompt("Please enter a reason for cancellation (optional):","Out of Stock");g(t,"cancelled",q||"No reason provided")}},k=t=>j.filter(q=>q.status===t).sort((q,c)=>q.timestamp.getTime()-c.timestamp.getTime()),y=({title:t,status:q,icon:c,color:o,nextStatus:a,actionLabel:r})=>{const n=k(q);return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:`flex items-center gap-2 mb-4 pb-2 border-b-2 ${o}`,children:[e.jsx(c,{className:"h-5 w-5 text-gray-700"}),e.jsx("h2",{className:"font-bold text-gray-700",children:t}),e.jsx("span",{className:"ml-auto bg-white px-2 py-0.5 rounded-full text-xs font-bold shadow-sm border",children:n.length})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3 pr-1",children:[n.map((s,l)=>e.jsxs(S,{className:"p-3 shadow-sm hover:shadow-md transition-shadow bg-white",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-lg",children:s.orderNumber}),e.jsx("p",{className:"text-xs text-gray-500",children:s.customerName})]}),e.jsx("span",{className:"text-xs text-gray-400",children:s.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:"mb-2",children:s.orderType==="online"?e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:"ðŸŒ Online"}):e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800",children:"ðŸª Walk-in"})}),e.jsx("div",{className:"space-y-2 mb-3",children:(s.orderItems||[]).map((i,d)=>{const x=E.find(O=>O.id===i.productId);return e.jsxs("div",{className:"text-sm flex items-center gap-3 bg-gray-50 p-2 rounded-lg",children:[(x==null?void 0:x.imageUrl)&&e.jsx("img",{src:x.imageUrl,alt:i.productName,className:"h-10 w-10 rounded-md object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"font-medium text-gray-900 truncate",children:i.productName}),e.jsxs("span",{className:"text-xs font-bold bg-white px-1.5 py-0.5 rounded border ml-2",children:["x",i.quantity]})]}),i.size&&e.jsx("p",{className:"text-xs text-gray-500",children:i.size})]})]},d)})}),s.paymentMethod==="gcash"&&e.jsxs("div",{className:"mt-2 mb-2 rounded bg-blue-50 p-2 text-xs text-blue-800 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-bold flex items-center gap-1",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-blue-500"}),"GCash"]}),s.receiptUrl&&e.jsxs("button",{onClick:()=>N(s),className:"flex items-center gap-1 text-blue-600 hover:text-blue-800 hover:underline font-medium",children:[e.jsx(z,{className:"h-3 w-3"}),"View Receipt"]})]}),s.paymentAccountName&&e.jsxs("div",{className:"mt-1 font-medium truncate",title:s.paymentAccountName,children:["Acct: ",s.paymentAccountName]}),s.paymentReference&&e.jsxs("div",{className:"mt-1 font-mono truncate",title:s.paymentReference,children:["Ref: ",s.paymentReference]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[q==="waiting"&&e.jsx("button",{onClick:()=>C(s.id),className:"p-1.5 text-red-500 hover:bg-red-50 rounded-md transition-colors",title:"Cancel Order",children:e.jsx(U,{className:"h-4 w-4"})}),a&&e.jsx($,{size:"sm",className:`w-full flex items-center justify-center gap-1 ${q==="waiting"&&l!==0?"bg-gray-600 hover:bg-gray-700":""}`,onClick:()=>{q==="waiting"&&l!==0?window.confirm(`âš ï¸ Are you sure you want to skip the previous ${l} order(s)?

It is recommended to serve orders in sequence.`)&&g(s.id,a):g(s.id,a)},title:q==="waiting"&&l!==0?"Click to skip previous orders":"",children:r||"Next"})]})]},s.id)),n.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm italic",children:"No orders"})]})]})};return w?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):e.jsxs("div",{className:"h-[calc(100vh-100px)] flex flex-col",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Queue Management"}),e.jsx("p",{className:"text-gray-500",children:"Real-time kitchen display system"})]}),e.jsx("div",{className:"flex gap-4 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{children:"Connected"})]})})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-6 overflow-hidden",children:[e.jsx(y,{title:"Waiting",status:"waiting",icon:F,color:"border-gray-400",nextStatus:"preparing",actionLabel:"Start Preparing"}),e.jsx(y,{title:"Preparing",status:"preparing",icon:P,color:"border-yellow-400",nextStatus:"ready",actionLabel:"Mark Ready"}),e.jsx(y,{title:"Ready to Serve",status:"ready",icon:I,color:"border-green-400",nextStatus:"completed",actionLabel:"Complete Order"})]}),f&&e.jsx(T,{order:f,isOpen:!!f,onClose:()=>N(null)})]})};export{J as default};
