import{c as q,j as e,B as z,S as J,r,n as D,C as S,U as K,x as ie,k as L,X as oe,l as F,p as W,o as fe,m as pe,T as ge,u as ce,V as ye,Q as X,W as Z,Y as V,Z as B,d as ee,h as G,E as je,D as be,y as se,s as Ne,J as we,H as ve,F as ke}from"./index-BRbIdYOP.js";import{B as b}from"./Button-KAlRQtN3.js";import{C as $}from"./coffee-BtfaIJWe.js";import{S as de}from"./star-CRQ68hbk.js";import{C as me}from"./calendar-DXuXpTCY.js";import{f as _}from"./format-BoV-TgZi.js";import{S as xe}from"./save-DoPUg3QX.js";import{S as Q}from"./shopping-bag-B9qVGLmH.js";import{C as Ce,a as Pe}from"./chevron-right-QaCuKhcG.js";import{I as Y}from"./Input-BwylH-D-.js";import{B as Se}from"./bell-BioM2b1r.js";import{S as te,f as Ie}from"./StarRating-CPWWPyXj.js";import{M as he}from"./message-square-Bud8KCGQ.js";import{T as Me}from"./thumbs-up-Dl2z2wnf.js";import{S as Ae}from"./send-CoQo0RJt.js";import{S as Oe}from"./settings-CF0B68YK.js";import{S as Re}from"./square-pen-JEk1Nkt9.js";import"./en-US-wfBU2YNu.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Fe=q("camera",Ee);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]],Ue=q("circle-dollar-sign",Te);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],ze=q("key",$e);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ae=q("upload",De),He=({user:s,onEditPhoto:l})=>{const u=(c,a)=>`${c.charAt(0)}${a.charAt(0)}`.toUpperCase(),i=c=>c==="admin"?"Admin":c==="employee"?"Employee":c==="customer"?"Customer":"";return e.jsxs("div",{className:"w-full bg-white shadow-sm",children:[e.jsx("div",{className:"relative h-48 w-full overflow-hidden bg-primary-600"}),e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"relative -mt-16 mb-6 flex flex-col items-center",children:[e.jsxs("div",{className:"relative h-32 w-32 transition-transform hover:scale-105",children:[s.photoURL?e.jsx("img",{src:s.photoURL,alt:`${s.firstName} ${s.lastName}`,className:"h-full w-full rounded-full border-4 border-white object-cover shadow-xl"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full border-4 border-white bg-gradient-to-br from-primary-400 to-primary-600 text-white shadow-xl",children:e.jsx("span",{className:"font-display text-4xl font-bold",children:u(s.firstName,s.lastName)})}),e.jsx("button",{onClick:l,className:"absolute bottom-1 right-1 flex h-9 w-9 items-center justify-center rounded-full bg-white text-gray-600 shadow-lg transition-all hover:bg-primary-50 hover:text-primary-600","aria-label":"Edit profile photo",children:e.jsx(Fe,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsxs("h1",{className:"font-display text-3xl font-bold text-gray-900",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-gray-500 font-medium",children:s.email}),e.jsxs("div",{className:"mt-3 flex flex-wrap justify-center gap-2",children:[s.role&&e.jsxs(z,{className:"bg-blue-50 text-blue-700 border border-blue-100 px-3 py-1",children:[e.jsx(J,{className:"mr-1.5 h-3.5 w-3.5"}),e.jsx("span",{children:i(s.role)})]}),e.jsx(z,{className:`px-3 py-1 border ${s.tier==="gold"?"bg-yellow-50 text-yellow-700 border-yellow-200":s.tier==="silver"?"bg-gray-50 text-gray-700 border-gray-200":"bg-orange-50 text-orange-800 border-orange-200"}`,children:e.jsxs("span",{className:"capitalize font-semibold",children:[s.tier," Member"]})})]})]})]})}),e.jsx("div",{className:"border-t border-gray-100 bg-gray-50/50",children:e.jsxs("div",{className:"container mx-auto grid grid-cols-2 gap-4 px-6 py-6 sm:grid-cols-4",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center border-r border-gray-200 last:border-0 sm:border-r",children:[e.jsx("div",{className:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-orange-100 text-orange-600",children:e.jsx($,{className:"h-5 w-5"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.totalOrders}),e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Orders"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center border-r border-gray-200 last:border-0 sm:border-r",children:[e.jsx("div",{className:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-green-100 text-green-600",children:e.jsx(Ue,{className:"h-5 w-5"})}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["₱",s.totalSpent.toLocaleString()]}),e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Spent"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center border-r border-gray-200 last:border-0 sm:border-r",children:[e.jsx("div",{className:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-yellow-100 text-yellow-600",children:e.jsx(de,{className:"h-5 w-5"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.currentPoints}),e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Points"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-blue-100 text-blue-600",children:e.jsx(me,{className:"h-5 w-5"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:_(s.createdAt,"MMM yyyy")}),e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Joined"})]})]})})]})},Le=({user:s,onSave:l,onCancel:u})=>{const[i,c]=r.useState({firstName:s.firstName,lastName:s.lastName,phone:s.phone||""}),[a,j]=r.useState({}),[y,p]=r.useState(!1),[N,h]=r.useState(!1),{showToast:f}=D();r.useEffect(()=>{const n=i.firstName!==s.firstName||i.lastName!==s.lastName||i.phone!==(s.phone||"");h(n)},[i,s]);const x=()=>{const n={};return i.firstName.length<2&&(n.firstName="First name must be at least 2 characters."),i.lastName.length<2&&(n.lastName="Last name must be at least 2 characters."),i.phone&&!/^(09|\+639)\d{9}$/.test(i.phone)&&(n.phone="Invalid Philippine phone number format."),j(n),Object.keys(n).length===0},t=n=>{c({...i,[n.target.name]:n.target.value})},g=n=>{n.preventDefault(),x()&&(p(!0),setTimeout(()=>{l(i),p(!1),f("Profile updated successfully!")},1e3))};return e.jsxs(S,{className:"w-full",children:[e.jsx("h2",{className:"mb-4 font-display text-xl font-bold text-coffee-900",children:"Edit Profile Information"}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"firstName",className:"block text-sm font-medium text-gray-700",children:"First Name"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(K,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",name:"firstName",id:"firstName",value:i.firstName,onChange:t,className:"w-full rounded-md border-gray-300 pl-10 shadow-sm focus:border-primary-500 focus:ring-primary-500",required:!0})]}),a.firstName&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a.firstName})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"lastName",className:"block text-sm font-medium text-gray-700",children:"Last Name"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(K,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",name:"lastName",id:"lastName",value:i.lastName,onChange:t,className:"w-full rounded-md border-gray-300 pl-10 shadow-sm focus:border-primary-500 focus:ring-primary-500",required:!0})]}),a.lastName&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a.lastName})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"tel",name:"phone",id:"phone",value:i.phone,onChange:t,className:"w-full rounded-md border-gray-300 pl-10 shadow-sm focus:border-primary-500 focus:ring-primary-500"})]}),a.phone&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a.phone})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(L,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"email",name:"email",id:"email",value:s.email||"",className:"w-full rounded-md border-gray-300 bg-gray-100 pl-10 text-gray-500 shadow-sm",disabled:!0,readOnly:!0})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Contact support to change your email address."})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-gray-200 pt-4",children:[e.jsxs(b,{type:"button",variant:"ghost",onClick:u,children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Cancel"]}),e.jsxs(b,{type:"submit",variant:"primary",disabled:!N||y,children:[y?e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Save Changes"]})]})]})]})},re={completed:{icon:fe,color:"bg-green-100 text-green-800"},cancelled:{icon:oe,color:"bg-red-100 text-red-800"},preparing:{icon:$,color:"bg-blue-100 text-blue-800"},waiting:{icon:$,color:"bg-yellow-100 text-yellow-800"},ready:{icon:$,color:"bg-purple-100 text-purple-800"}},qe={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},_e={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},Ve=({order:s})=>{var p,N;const l=((p=re[s.status])==null?void 0:p.icon)||$,u=((N=re[s.status])==null?void 0:N.color)||"bg-gray-100 text-gray-800",{addMultipleToCart:i,showToast:c}=D(),{products:a}=pe(),j=()=>{const h=[],f=[];for(const x of s.orderItems){const t=a.find(w=>w.id===x.productId);if(!t||!t.available||t.stock===0){f.push(x.productName);continue}const g=x.productName.match(/\((Grande|Venti)\)$/),n=g?g[1]:null;if(!n){f.push(x.productName);continue}const C=t.sizes.find(w=>w.name===n);if(!C){f.push(x.productName);continue}h.push({product:t,selectedSize:C,quantity:x.quantity,customizations:x.customizations})}h.length>0&&i(h),f.length>0&&c(`Could not add: ${f.join(", ")}. They may be unavailable.`)},y=()=>{const h=s.orderItems;return h.length<=2?h.map(x=>`${x.quantity}x ${x.productName}`).join(", "):`${h.slice(0,2).map(x=>x.productName).join(", ")}, and ${h.length-2} more item(s)`};return e.jsx(S,{className:"transition-shadow duration-300",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-mono text-sm font-semibold text-primary-700",children:s.orderNumber}),e.jsxs(z,{className:`capitalize ${u}`,children:[e.jsx(l,{className:"mr-1 h-3 w-3"}),s.status]})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:_(s.timestamp,"MMM dd, yyyy • hh:mm a")}),e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:y()}),s.status==="cancelled"&&s.cancellationReason&&e.jsxs("div",{className:"mt-2 rounded-md bg-red-50 p-2 text-sm text-red-700 border border-red-100",children:[e.jsx("span",{className:"font-semibold",children:"Reason:"})," ",s.cancellationReason]})]}),e.jsxs("div",{className:"flex-shrink-0 text-right sm:ml-4",children:[e.jsxs("p",{className:"font-display text-2xl font-bold text-coffee-900",children:["₱",s.totalAmount.toFixed(2)]}),e.jsxs(b,{size:"sm",variant:"secondary",className:"mt-2",onClick:j,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Reorder"]})]})]})})},le=({orders:s,limit:l,showViewAll:u,onViewAll:i})=>{const[c,a]=r.useState(1),j=10,y=r.useRef(null),p=r.useMemo(()=>[...s].sort((t,g)=>g.timestamp.getTime()-t.timestamp.getTime()),[s]),N=Math.ceil(p.length/j),h=r.useMemo(()=>{if(l)return p.slice(0,l);const t=(c-1)*j;return p.slice(t,t+j)},[p,l,c]),f=r.useMemo(()=>{const t={};return h.forEach(g=>{const n=_(g.timestamp,"MMMM dd, yyyy");t[n]||(t[n]=[]),t[n].push(g)}),t},[h]),x=t=>{if(a(t),y.current){const C=y.current.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:C,behavior:"smooth"})}};return s.length===0?e.jsxs("div",{className:"py-16 text-center",children:[e.jsx(Q,{className:"mx-auto h-16 w-16 text-gray-300"}),e.jsx("h3",{className:"mt-4 text-xl font-semibold text-gray-800",children:"No Orders Yet"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Your past orders will appear here."}),e.jsx(b,{size:"lg",className:"mt-6",children:"Browse Menu"})]}):e.jsxs("div",{ref:y,children:[e.jsx(W.div,{className:"space-y-8",variants:qe,initial:"hidden",animate:"visible",children:Object.entries(f).map(([t,g])=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-4 sticky top-0 bg-gray-50/95 backdrop-blur py-2 z-10",children:t}),e.jsx("div",{className:"space-y-4",children:g.map(n=>e.jsx(W.div,{variants:_e,layout:!0,children:e.jsx(Ve,{order:n})},n.id))})]},t))}),!l&&N>1&&e.jsxs("div",{className:"mt-8 flex justify-center items-center gap-2",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:()=>x(c-1),disabled:c===1,className:"p-2",children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:N},(t,g)=>g+1).map(t=>e.jsx("button",{onClick:()=>x(t),className:`w-8 h-8 rounded-full text-sm font-medium transition-colors ${c===t?"bg-primary-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:t},t))}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>x(c+1),disabled:c===N,className:"p-2",children:e.jsx(Pe,{className:"h-4 w-4"})})]}),u&&p.length>(l||0)&&e.jsx("div",{className:"mt-6 text-center",children:e.jsx(b,{variant:"ghost",onClick:i,children:"View All Orders"})})]})},U=({label:s,description:l,enabled:u,onChange:i,Icon:c})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-800",children:s}),e.jsx("p",{className:"text-sm text-gray-500",children:l})]})]}),e.jsx("button",{type:"button",className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 ${u?"bg-primary-600":"bg-gray-200"}`,role:"switch","aria-checked":u,onClick:()=>i(!u),children:e.jsx("span",{"aria-hidden":"true",className:`inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${u?"translate-x-5":"translate-x-0"}`})})]}),Be=({preferences:s,onUpdatePreferences:l})=>{const[u,i]=r.useState(s),[c,a]=r.useState(!1),[j,y]=r.useState(!1),{showToast:p}=D(),{updateUserPassword:N}=ce(),h=(o,P,M)=>{const H={...u,[o]:{...u[o],[P]:M}};i(H),l({[o]:H[o]}),p("Preferences updated!")},[f,x]=r.useState({current:"",new:"",confirm:""}),[t,g]=r.useState({current:!1,new:!1,confirm:!1}),[n,C]=r.useState(!1),[w,v]=r.useState(null),[T,E]=r.useState({password:"",checkbox:!1}),[d,k]=r.useState(!1),R=o=>{x({...f,[o.target.name]:o.target.value}),v(null)},I=o=>{g({...t,[o]:!t[o]})},O=async o=>{if(o.preventDefault(),v(null),f.new!==f.confirm){v("New passwords do not match.");return}if(f.new.length<6){v("Password must be at least 6 characters.");return}C(!0);try{await N(f.current,f.new),p("Password updated successfully!"),a(!1),x({current:"",new:"",confirm:""})}catch(P){console.error("Error updating password:",P),P.code==="auth/wrong-password"?v("Incorrect current password."):v("Failed to update password. Please try again.")}finally{C(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(S,{children:[e.jsx("h2",{className:"mb-4 font-display text-2xl font-bold text-coffee-900",children:"Preferences & Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-500",children:"Notifications"}),e.jsx(U,{Icon:Se,label:"Push Notifications",description:"Get notified when order is ready",enabled:u.notifications.push,onChange:o=>h("notifications","push",o)}),e.jsx(U,{Icon:L,label:"Email Updates",description:"Receive order updates via email",enabled:u.notifications.emailUpdates,onChange:o=>h("notifications","emailUpdates",o)}),e.jsx(U,{Icon:L,label:"Marketing Emails",description:"Get news and promotions",enabled:u.notifications.marketing,onChange:o=>h("notifications","marketing",o)})]}),e.jsx("hr",{className:"my-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-500",children:"Privacy"}),e.jsx(U,{Icon:J,label:"Share anonymous usage data",description:"Help us improve our services",enabled:u.privacy.shareUsageData,onChange:o=>h("privacy","shareUsageData",o)}),e.jsx(U,{Icon:J,label:"Personalized recommendations",description:"Get recommendations based on your activity",enabled:u.privacy.personalizedRecs,onChange:o=>h("privacy","personalizedRecs",o)})]})]}),e.jsxs(S,{className:"mt-6 border-l-4 border-red-500",children:[e.jsx("h2",{className:"mb-4 font-display text-xl font-bold text-red-700",children:"Account Management"}),e.jsxs("div",{className:"flex flex-col items-start gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Change Password"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Update your password for better security."})]}),e.jsxs(b,{variant:"secondary",onClick:()=>a(!0),children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),"Change Password"]})]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"flex flex-col items-start gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Delete Account"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Permanently delete your account and all data."})]}),e.jsxs(b,{variant:"danger",onClick:()=>y(!0),children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Delete Account"]})]})]}),e.jsx(X,{isOpen:c,onClose:()=>a(!1),title:"Change Password",children:e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[w&&e.jsxs("div",{className:"p-3 bg-red-50 text-red-600 text-sm rounded-lg flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),w]}),e.jsx(Y,{label:"Current Password",type:t.current?"text":"password",name:"current",value:f.current,onChange:R,required:!0,endIcon:e.jsx("button",{type:"button",onClick:()=>I("current"),className:"text-gray-900 hover:text-gray-700 cursor-pointer",children:t.current?e.jsx(V,{className:"h-4 w-4"}):e.jsx(B,{className:"h-4 w-4"})})}),e.jsx(Y,{label:"New Password",type:t.new?"text":"password",name:"new",value:f.new,onChange:R,required:!0,endIcon:e.jsx("button",{type:"button",onClick:()=>I("new"),className:"text-gray-900 hover:text-gray-700 cursor-pointer",children:t.new?e.jsx(V,{className:"h-4 w-4"}):e.jsx(B,{className:"h-4 w-4"})})}),e.jsx(Y,{label:"Confirm New Password",type:t.confirm?"text":"password",name:"confirm",value:f.confirm,onChange:R,required:!0,endIcon:e.jsx("button",{type:"button",onClick:()=>I("confirm"),className:"text-gray-900 hover:text-gray-700 cursor-pointer",children:t.confirm?e.jsx(V,{className:"h-4 w-4"}):e.jsx(B,{className:"h-4 w-4"})})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(b,{type:"button",variant:"ghost",onClick:()=>a(!1),children:"Cancel"}),e.jsxs(b,{type:"submit",disabled:n,children:[n?e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Update Password"]})]})]})}),e.jsx(X,{isOpen:j,onClose:()=>y(!1),title:"Delete Account",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:e.jsx(Z,{className:"h-6 w-6 text-red-600","aria-hidden":"true"})}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"Are you absolutely sure?"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"This action cannot be undone. This will permanently delete your account, orders, and rewards."}),e.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Account deletion functionality is coming soon."})]})})]})},Ge=({user:s})=>{const[l,u]=r.useState("feedback"),[i,c]=r.useState(0),[a,j]=r.useState("food"),[y,p]=r.useState(""),[N,h]=r.useState(!1),[f,x]=r.useState([]),[t,g]=r.useState(!0),[n,C]=r.useState(null),{showToast:w}=D();r.useEffect(()=>{if(!s)return;const k=ee.collection("feedback").where("userId","==",s.uid).onSnapshot(R=>{const I=[];R.forEach(O=>{var P,M;const o=O.data();I.push({id:O.id,...o,createdAt:(P=o.createdAt)==null?void 0:P.toDate(),updatedAt:(M=o.updatedAt)==null?void 0:M.toDate()})}),I.sort((O,o)=>{var P,M;return(((P=o.createdAt)==null?void 0:P.getTime())||0)-(((M=O.createdAt)==null?void 0:M.getTime())||0)}),x(I),g(!1)});return()=>k()},[s]);const v=d=>{u(d),p(""),d==="issue"?(c(0),j("system")):(c(0),j("food"))},T=async d=>{if(d.preventDefault(),l==="feedback"&&i===0){w("Please provide a rating.");return}if(y.trim().length<10){w("Please provide a description (at least 10 characters).");return}h(!0);try{await ee.collection("feedback").add({userId:s.uid,rating:l==="issue"?0:i,category:a,comment:y,status:"pending",createdAt:se.firestore.FieldValue.serverTimestamp(),updatedAt:se.firestore.FieldValue.serverTimestamp(),type:l}),w(l==="issue"?"Issue reported successfully!":"Feedback submitted successfully!"),c(0),p(""),l==="feedback"&&j("food")}catch(k){console.error("Error submitting feedback: ",k),w("Failed to submit. Please try again.")}finally{h(!1)}},E={pending:"bg-yellow-100 text-yellow-800",published:"bg-blue-100 text-blue-800",resolved:"bg-green-100 text-green-800"};return e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(S,{children:[e.jsx("h2",{className:"mb-4 font-display text-2xl font-bold text-coffee-900",children:"Your History"}),t?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(F,{className:"h-8 w-8 animate-spin text-primary-600"})}):f.length>0?e.jsx("div",{className:"space-y-3",children:f.map(d=>e.jsxs("div",{className:"rounded-lg border border-gray-200",children:[e.jsxs("button",{onClick:()=>C(n===d.id?null:d.id),className:"flex w-full items-center justify-between p-4 text-left",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[d.rating>0?e.jsx(te,{rating:d.rating,size:"sm",readonly:!0}):e.jsxs("div",{className:"flex items-center gap-1 text-xs font-bold text-red-600 bg-red-50 px-2 py-1 rounded-full",children:[e.jsx(G,{className:"h-3 w-3"}),"Issue Report"]}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx("p",{className:"font-semibold text-gray-800 truncate",children:d.comment}),e.jsx("p",{className:"text-xs text-gray-500",children:d.createdAt?Ie(d.createdAt,{addSuffix:!0}):"Just now"})]})]}),e.jsx(je,{className:`h-5 w-5 transform transition-transform ${n===d.id?"rotate-180":""}`})]}),e.jsx(be,{children:n===d.id&&e.jsx(W.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"border-t p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(z,{className:"capitalize bg-gray-100 text-gray-600",children:d.category}),e.jsx(z,{className:`capitalize ${E[d.status]}`,children:d.status})]}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:d.comment}),d.response&&e.jsxs("div",{className:"mt-4 rounded-md border-l-4 border-primary-400 bg-primary-50 p-3",children:[e.jsx("p",{className:"font-semibold text-primary-800",children:"Response from Rush Coffee:"}),e.jsxs("p",{className:"mt-1 text-sm text-primary-700 italic",children:['"',d.response,'"']})]})]})})})]},d.id))}):e.jsxs("div",{className:"py-10 text-center text-gray-500",children:[e.jsx(he,{className:"mx-auto h-12 w-12 text-gray-300"}),e.jsx("p",{className:"mt-2 font-semibold",children:"No history found."}),e.jsx("p",{className:"text-sm",children:"Share your thoughts or report issues using the form!"})]})]})}),e.jsx("div",{children:e.jsxs(S,{children:[e.jsxs("div",{className:"flex p-1 mb-6 bg-gray-100 rounded-lg",children:[e.jsxs("button",{onClick:()=>v("feedback"),className:`flex-1 flex items-center justify-center gap-2 py-2 text-sm font-medium rounded-md transition-all ${l==="feedback"?"bg-white text-primary-700 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(Me,{className:"h-4 w-4"}),"Give Feedback"]}),e.jsxs("button",{onClick:()=>v("issue"),className:`flex-1 flex items-center justify-center gap-2 py-2 text-sm font-medium rounded-md transition-all ${l==="issue"?"bg-white text-red-600 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(G,{className:"h-4 w-4"}),"Report Issue"]})]}),e.jsx("h2",{className:"mb-4 font-display text-2xl font-bold text-coffee-900",children:l==="feedback"?"Share Your Experience":"Report a Problem"}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[l==="feedback"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Overall Rating"}),e.jsx(te,{rating:i,onRatingChange:c})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700",children:"Category"}),e.jsxs("select",{id:"category",value:a,onChange:d=>j(d.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500",children:[e.jsx("option",{value:"food",children:"Food & Drinks"}),e.jsx("option",{value:"service",children:"Service"}),e.jsx("option",{value:"system",children:"App/Website"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"comment",className:"block text-sm font-medium text-gray-700",children:l==="feedback"?"Comments":"Describe the issue"}),e.jsx("textarea",{id:"comment",value:y,onChange:d=>p(d.target.value),rows:4,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500",placeholder:l==="feedback"?"Tell us more about your experience...":"Please describe the issue in detail..."})]}),e.jsxs(b,{type:"submit",disabled:N,className:`w-full ${l==="issue"?"bg-red-600 hover:bg-red-700":""}`,children:[N?e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}):l==="issue"?e.jsx(G,{className:"mr-2 h-4 w-4"}):e.jsx(Ae,{className:"mr-2 h-4 w-4"}),N?"Submitting...":l==="issue"?"Report Issue":"Submit Feedback"]})]})]})})]})},ne=()=>e.jsx(S,{className:"animate-pulse",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex-grow space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"h-4 w-1/3 rounded bg-gray-300"}),e.jsx("div",{className:"h-5 w-1/4 rounded-full bg-gray-300"})]}),e.jsx("div",{className:"h-3 w-1/4 rounded bg-gray-300"}),e.jsx("div",{className:"h-4 w-1/2 rounded bg-gray-300"})]}),e.jsxs("div",{className:"flex-shrink-0 space-y-2 text-right sm:ml-4",children:[e.jsx("div",{className:"h-8 w-24 rounded bg-gray-300 ml-auto"}),e.jsx("div",{className:"h-8 w-28 rounded-full bg-gray-300 ml-auto"})]})]})}),ms=()=>{const{currentUser:s,updateUserProfile:l,updateUserPhoto:u}=ce(),{orderHistory:i,isHistoryLoading:c}=Ne(),[a,j]=r.useState(null),[y,p]=r.useState("overview"),[N,h]=r.useState(!1),[f,x]=r.useState(!1),[t,g]=r.useState(null),[n,C]=r.useState(null),[w,v]=r.useState(!1),T=r.useRef(null),{showToast:E,addToCart:d}=D();r.useEffect(()=>{j(s)},[s]),r.useEffect(()=>{if(!t){C(null);return}const m=URL.createObjectURL(t);return C(m),()=>URL.revokeObjectURL(m)},[t]);const k=r.useMemo(()=>a?we.find(m=>m.id==="cb-01"):null,[a]),R=m=>{a&&l&&(l(m),h(!1))},I=m=>{a&&j(A=>A?{...A,preferences:{...A.preferences,...m}}:null)},O=m=>{if(m.target.files&&m.target.files[0]){if(m.target.files[0].size>2*1024*1024){E("File size should not exceed 2MB.");return}g(m.target.files[0])}},o=()=>{if(!t||!a||!u)return;v(!0);const m=new FileReader;m.readAsDataURL(t),m.onloadend=async()=>{const A=m.result;try{await u(A),v(!1),x(!1),g(null),E("Profile photo updated!")}catch(ue){console.error("Error updating photo:",ue),E("Failed to update photo."),v(!1)}}},P=()=>{k&&d(k,k.sizes[0])};if(!a)return e.jsx("div",{className:"flex h-screen items-center justify-center bg-gray-50",children:e.jsx(F,{className:"h-12 w-12 animate-spin text-primary-600"})});const M=[{id:"overview",label:"Overview",Icon:K},{id:"orders",label:"Order History",Icon:Q},{id:"feedback",label:"My Feedback",Icon:he},{id:"settings",label:"Settings",Icon:Oe}],H=()=>{switch(y){case"orders":return c?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((m,A)=>e.jsx(ne,{},A))}):e.jsx(le,{orders:i});case"settings":return e.jsx(Be,{preferences:a.preferences,onUpdatePreferences:I});case"feedback":return e.jsx(Ge,{user:a});case"overview":default:return e.jsxs("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-8 lg:col-span-2",children:[N?e.jsx(Le,{user:a,onSave:R,onCancel:()=>h(!1)}):e.jsxs(S,{className:"overflow-hidden border-none shadow-md transition-shadow hover:shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 pb-4 mb-4",children:[e.jsx("h3",{className:"font-display text-xl font-bold text-gray-900",children:"Personal Information"}),e.jsxs(b,{variant:"ghost",size:"sm",onClick:()=>h(!0),className:"text-primary-600 hover:bg-primary-50",children:[e.jsx(Re,{className:"mr-2 h-4 w-4"})," Edit"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-blue-100 text-blue-600",children:e.jsx(L,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase",children:"Email Address"}),e.jsx("p",{className:"text-gray-900 font-medium",children:a.email})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-purple-100 text-purple-600",children:e.jsx(ie,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase",children:"Phone Number"}),e.jsx("p",{className:"text-gray-900 font-medium",children:a.phone||"Not provided"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-orange-100 text-orange-600",children:e.jsx(me,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase",children:"Member Since"}),e.jsx("p",{className:"text-gray-900 font-medium",children:_(a.createdAt,"MMMM dd, yyyy")})]})]})]})]}),c?e.jsxs(S,{className:"border-none shadow-md",children:[e.jsx("h3",{className:"font-display text-xl font-bold text-gray-900 mb-4",children:"Recent Orders"}),e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((m,A)=>e.jsx(ne,{},A))})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-display text-xl font-bold text-gray-900",children:"Recent Orders"}),e.jsx(b,{variant:"link",onClick:()=>p("orders"),className:"text-primary-600",children:"View All"})]}),e.jsx(le,{orders:i,limit:3,showViewAll:!1})]})]}),e.jsxs("div",{className:"space-y-8 lg:col-span-1",children:[e.jsxs(S,{className:`border-none shadow-md text-white overflow-hidden relative ${a.tier==="gold"?"bg-gradient-to-br from-yellow-500 to-yellow-700":a.tier==="silver"?"bg-gradient-to-br from-gray-400 to-gray-600":"bg-gradient-to-br from-orange-400 to-orange-600"}`,children:[e.jsx("div",{className:"absolute top-0 right-0 -mt-4 -mr-4 h-24 w-24 rounded-full bg-white opacity-10 blur-xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 -mb-4 -ml-4 h-24 w-24 rounded-full bg-black opacity-10 blur-xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm font-medium uppercase tracking-wider",children:"Current Tier"}),e.jsxs("h3",{className:"font-display text-2xl font-bold capitalize",children:[a.tier," Member"]})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-white/20 flex items-center justify-center backdrop-blur-sm",children:e.jsx(de,{className:"h-6 w-6 text-white",fill:"currentColor"})})]}),e.jsxs("div",{className:"mb-2 flex justify-between items-end",children:[e.jsx("span",{className:"text-3xl font-bold",children:a.currentPoints}),e.jsx("span",{className:"text-sm text-white/80 mb-1",children:"points earned"})]}),e.jsx("div",{className:"w-full bg-black/20 rounded-full h-2 mb-4",children:e.jsx("div",{className:"bg-white h-2 rounded-full transition-all duration-500 shadow-[0_0_10px_rgba(255,255,255,0.5)]",style:{width:`${Math.min(a.currentPoints%1e3/10,100)}%`}})}),e.jsx("p",{className:"text-sm text-white/90",children:a.tier==="gold"?"You are at the highest tier! Enjoy your exclusive benefits.":`Earn ${1e3-a.currentPoints%1e3} more points to reach ${a.tier==="bronze"?"Silver":"Gold"} tier.`})]})]}),k&&e.jsxs(S,{className:"border-none shadow-md transition-shadow hover:shadow-lg overflow-hidden group",children:[e.jsx("h3",{className:"font-display text-xl font-bold text-gray-900 mb-4",children:"Your Favorite"}),e.jsxs("div",{className:"relative aspect-square w-full overflow-hidden rounded-xl mb-4",children:[e.jsx("img",{src:k.imageUrl,alt:k.name,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex flex-col justify-end p-4",children:[e.jsx("p",{className:"font-bold text-white text-lg",children:k.name}),e.jsx("p",{className:"text-white/80 text-sm",children:k.category})]})]}),e.jsxs(b,{className:"w-full rounded-xl py-3 font-bold shadow-lg shadow-primary-600/20",onClick:P,children:["Order Again ",e.jsx(Q,{className:"ml-2 h-4 w-4"})]})]})]})]})}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(ve,{}),e.jsxs("main",{children:[e.jsx(He,{user:a,onEditPhoto:()=>x(!0)}),e.jsx("div",{className:"sticky top-16 z-30 border-b border-gray-200 bg-white/95 backdrop-blur-sm sm:top-20",children:e.jsx("div",{className:"container mx-auto max-w-7xl px-4 sm:px-6",children:e.jsx("nav",{className:"-mb-px flex space-x-6 overflow-x-auto py-4 no-scrollbar",children:M.map(m=>e.jsxs("button",{onClick:()=>p(m.id),className:`group inline-flex shrink-0 items-center gap-2 rounded-full px-4 py-2 text-sm font-medium transition-all ${y===m.id?"bg-primary-600 text-white shadow-md":"bg-transparent text-gray-500 hover:bg-gray-100 hover:text-gray-900"}`,children:[e.jsx(m.Icon,{className:`h-4 w-4 ${y===m.id?"text-white":"text-gray-400 group-hover:text-gray-600"}`}),m.label]},m.id))})})}),e.jsx("div",{className:"container mx-auto max-w-7xl p-6",children:H()})]}),e.jsx(ke,{}),e.jsx(X,{isOpen:f,onClose:()=>x(!1),title:"Upload New Photo",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"file",ref:T,onChange:O,accept:"image/*",className:"hidden"}),e.jsx("div",{className:"flex cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-6 text-center transition hover:bg-gray-100",onClick:()=>{var m;return(m=T.current)==null?void 0:m.click()},children:n?e.jsx("img",{src:n,alt:"Preview",className:"h-32 w-32 rounded-full object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-12 w-12 text-gray-400"}),e.jsx("span",{className:"mt-2 block text-sm font-semibold text-gray-600",children:"Click to upload"}),e.jsx("span",{className:"mt-1 block text-xs text-gray-500",children:"PNG or JPG (MAX. 2MB)"})]})}),w&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-primary-600 h-2.5 rounded-full animate-pulse",style:{width:"100%"}})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(b,{variant:"ghost",onClick:()=>x(!1),children:"Cancel"}),e.jsxs(b,{onClick:o,disabled:!t||w,children:[w?e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Upload Photo"]})]})]})})]})};export{ms as default};
