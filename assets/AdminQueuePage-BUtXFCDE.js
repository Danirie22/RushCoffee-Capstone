import{r as m,n as C,m as k,t as L,d as h,j as e,i as O,C as S,T}from"./index-C0udEWay.js";import{B as I}from"./Button-BXzODrPk.js";import{d as U}from"./inventoryDeduction-DA2OUBCA.js";import{C as B}from"./clock-C0L02mkQ.js";import{C as D}from"./coffee-7CoYvDIa.js";import"./mockCustomizationOptions-CwPUP-Xn.js";const F=()=>{const[f,y]=m.useState([]),[j,N]=m.useState(!0),{showToast:g}=C(),{products:v}=k(),u=L.useRef(0);m.useEffect(()=>{const q=()=>{new Audio("data:audio/mp3;base64,//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq").play().catch(()=>{}),document.removeEventListener("click",q),document.removeEventListener("touchstart",q)};return document.addEventListener("click",q),document.addEventListener("touchstart",q),()=>{document.removeEventListener("click",q),document.removeEventListener("touchstart",q)}},[]),m.useEffect(()=>{const q=h.collection("orders").orderBy("timestamp","desc").limit(100).onSnapshot(t=>{const n=t.docs.map(r=>{var a;const s=r.data();return{id:r.id,...s,orderItems:s.orderItems||s.items||[],timestamp:(a=s.timestamp)!=null&&a.toDate?s.timestamp.toDate():s.timestamp?new Date(s.timestamp):new Date}});n.length>u.current&&u.current!==0&&new Audio("data:audio/mp3;base64,//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq").play().catch(s=>console.log("Audio play failed:",s)),u.current=n.length,y(n),N(!1)});return()=>q()},[]);const x=async(q,t,n)=>{try{const r={status:t,updatedAt:new Date};if(n&&(r.cancellationReason=n),t==="ready"){const s=await h.collection("orders").doc(q).get();if(s.exists){const a=s.data();if(a!=null&&a.inventoryDeducted)console.log(`‚ÑπÔ∏è Inventory already deducted for order ${q}. Skipping.`);else if(a&&a.orderItems){console.log(`üìâ Deducting inventory for order ${q} (Status: Ready)`);try{await U(a.orderItems),r.inventoryDeducted=!0}catch(d){console.error("‚ö†Ô∏è Failed to deduct inventory:",d)}}}}await h.collection("orders").doc(q).update(r),g(`Order updated to ${t}`)}catch(r){console.error("Error updating order status:",r),g("Failed to update order status")}},b=q=>{if(window.confirm("Are you sure you want to cancel this order?")){const t=window.prompt("Please enter a reason for cancellation (optional):","Out of Stock");x(q,"cancelled",t||"No reason provided")}},A=q=>f.filter(t=>t.status===q).sort((t,n)=>t.timestamp.getTime()-n.timestamp.getTime()),p=({title:q,status:t,icon:n,color:r,nextStatus:s,actionLabel:a})=>{const d=A(t);return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:`flex items-center gap-2 mb-4 pb-2 border-b-2 ${r}`,children:[e.jsx(n,{className:"h-5 w-5 text-gray-700"}),e.jsx("h2",{className:"font-bold text-gray-700",children:q}),e.jsx("span",{className:"ml-auto bg-white px-2 py-0.5 rounded-full text-xs font-bold shadow-sm border",children:d.length})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3 pr-1",children:[d.map((o,c)=>e.jsxs(S,{className:"p-3 shadow-sm hover:shadow-md transition-shadow bg-white",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-lg",children:o.orderNumber}),e.jsx("p",{className:"text-xs text-gray-500",children:o.customerName})]}),e.jsx("span",{className:"text-xs text-gray-400",children:o.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:"mb-2",children:o.orderType==="online"?e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:"üåê Online"}):e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800",children:"üè™ Walk-in"})}),e.jsx("div",{className:"space-y-2 mb-3",children:(o.orderItems||[]).map((i,w)=>{const l=v.find(E=>E.id===i.productId);return e.jsxs("div",{className:"text-sm flex items-center gap-3 bg-gray-50 p-2 rounded-lg",children:[(l==null?void 0:l.imageUrl)&&e.jsx("img",{src:l.imageUrl,alt:i.productName,className:"h-10 w-10 rounded-md object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"font-medium text-gray-900 truncate",children:i.productName}),e.jsxs("span",{className:"text-xs font-bold bg-white px-1.5 py-0.5 rounded border ml-2",children:["x",i.quantity]})]}),i.size&&e.jsx("p",{className:"text-xs text-gray-500",children:i.size})]})]},w)})}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[t==="waiting"&&e.jsx("button",{onClick:()=>b(o.id),className:"p-1.5 text-red-500 hover:bg-red-50 rounded-md transition-colors",title:"Cancel Order",children:e.jsx(T,{className:"h-4 w-4"})}),s&&e.jsx(I,{size:"sm",className:`w-full flex items-center justify-center gap-1 ${t==="waiting"&&c!==0?"bg-gray-600 hover:bg-gray-700":""}`,onClick:()=>{t==="waiting"&&c!==0?window.confirm(`‚ö†Ô∏è Are you sure you want to skip the previous ${c} order(s)?

It is recommended to serve orders in sequence.`)&&x(o.id,s):x(o.id,s)},title:t==="waiting"&&c!==0?"Click to skip previous orders":"",children:a||"Next"})]})]},o.id)),d.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm italic",children:"No orders"})]})]})};return j?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):e.jsxs("div",{className:"h-[calc(100vh-100px)] flex flex-col",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Queue Management"}),e.jsx("p",{className:"text-gray-500",children:"Real-time kitchen display system"})]}),e.jsx("div",{className:"flex gap-4 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{children:"Connected"})]})})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-6 overflow-hidden",children:[e.jsx(p,{title:"Waiting",status:"waiting",icon:B,color:"border-gray-400",nextStatus:"preparing",actionLabel:"Start Preparing"}),e.jsx(p,{title:"Preparing",status:"preparing",icon:D,color:"border-yellow-400",nextStatus:"ready",actionLabel:"Mark Ready"}),e.jsx(p,{title:"Ready to Serve",status:"ready",icon:O,color:"border-green-400",nextStatus:"completed",actionLabel:"Complete Order"})]})]})};export{F as default};
