import{c as C,j as e,r as d,n as E,l as y,h as A,C as g,d as b}from"./index-CeTvPb5i.js";import{B as M}from"./Button-7EiVU78F.js";import{I as m}from"./Input-CvH-8zzi.js";import{T as k}from"./Textarea-BQ7SRXvB.js";import{S as T}from"./store-DX_VNmVR.js";import{C as D}from"./clock-DRheYq4O.js";import{S as F}from"./save-BaK_6ap_.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]],N=C("megaphone",P),I=({enabled:s,onChange:r,label:x,description:h,Icon:o})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[o&&e.jsx(o,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-800",children:x}),h&&e.jsx("p",{className:"text-sm text-gray-500",children:h})]})]}),e.jsx("button",{type:"button",className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 ${s?"bg-primary-600":"bg-gray-200"}`,role:"switch","aria-checked":s,onClick:()=>r(!s),children:e.jsx("span",{"aria-hidden":"true",className:`inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${s?"translate-x-5":"translate-x-0"}`})})]}),u={shopName:"Rush Coffee",address:"123 Coffee Street, Malate, Manila",phone:"+63 917 123 4567",email:"hello@rushcoffee.ph",operatingHours:"Mon-Sun: 7:00 AM - 10:00 PM",announcement:{enabled:!1,message:"Welcome to Rush Coffee! Enjoy our new Matcha series."}},O=()=>{const[s,r]=d.useState(u),[x,h]=d.useState(!0),[o,p]=d.useState(!1),[i,l]=d.useState(null),{showToast:v}=E();d.useEffect(()=>{(async()=>{const n=b.collection("settings").doc("shopConfig");try{const t=await n.get();t.exists?r({...u,...t.data()}):r(u)}catch(t){if(console.error("Error fetching settings:",t),t.code==="permission-denied"){const w=e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-bold",children:"Permission Denied: Cannot access Shop Settings."}),e.jsx("p",{className:"mt-1",children:"This is a Firestore security rule issue. Please update your rules in the Firebase Console to allow admins to manage settings."}),e.jsxs("p",{className:"mt-2",children:["Ensure you have a rule like this in your ",e.jsx("code",{className:"bg-red-200 text-red-900 px-1 rounded",children:"firestore.rules"})," file:"]}),e.jsx("pre",{className:"mt-2 text-xs bg-red-200 text-red-900 p-2 rounded-md overflow-x-auto",children:e.jsx("code",{children:`
service cloud.firestore {
  match /databases/{database}/documents {
    // ... your other rules ...

    // ADD OR UPDATE THIS RULE:
    match /settings/{docId} {
      allow read: if true;
      allow write: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
  }
}`.trim()})})]});l(w)}else l("An error occurred while loading shop settings. Please check the console for details.");r(u)}finally{h(!1)}})()},[]);const c=a=>{const{name:n,value:t}=a.target;r(j=>({...j,[n]:t}))},f=(a,n)=>{r(t=>({...t,announcement:{...t.announcement,[a]:n}}))},S=async a=>{a.preventDefault(),p(!0);try{await b.collection("settings").doc("shopConfig").set(s,{merge:!0}),v("Settings saved successfully!"),i&&l(null)}catch(n){console.error("Error saving settings:",n),n.code==="permission-denied"?l("Save Failed: Your account does not have permission to write to shop settings. Please check your Firestore security rules. Changes were not saved."):l("Failed to save settings. An error occurred.")}finally{p(!1)}};return x?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(y,{className:"h-12 w-12 animate-spin text-primary-600"})}):e.jsxs("div",{children:[e.jsx("h1",{className:"mb-6 font-display text-3xl font-bold text-gray-800",children:"Shop Settings"}),i&&e.jsxs("div",{className:"mb-6 flex items-start gap-3 rounded-lg bg-red-50 p-4 text-sm text-red-700",children:[e.jsx(A,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),e.jsx("div",{children:i})]}),e.jsxs("form",{onSubmit:S,className:"mx-auto max-w-4xl space-y-6",children:[e.jsxs("fieldset",{disabled:!!i,className:"space-y-6 disabled:opacity-50",children:[e.jsxs(g,{children:[e.jsxs("h2",{className:"mb-4 flex items-center gap-2 text-xl font-bold text-gray-800",children:[e.jsx(T,{className:"h-5 w-5 text-primary-600"}),"Shop Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(m,{label:"Shop Name",name:"shopName",id:"shopName",value:s.shopName,onChange:c,placeholder:"Enter shop name"}),e.jsx(m,{label:"Address",name:"address",id:"address",value:s.address,onChange:c,placeholder:"Enter shop address"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(m,{label:"Contact Phone",name:"phone",id:"phone",type:"tel",value:s.phone,onChange:c,placeholder:"Enter contact phone"}),e.jsx(m,{label:"Contact Email",name:"email",id:"email",type:"email",value:s.email,onChange:c,placeholder:"Enter contact email"})]})]})]}),e.jsxs(g,{children:[e.jsxs("h2",{className:"mb-4 flex items-center gap-2 text-xl font-bold text-gray-800",children:[e.jsx(D,{className:"h-5 w-5 text-primary-600"}),"Operating Hours"]}),e.jsx("div",{children:e.jsx(k,{label:"Display Text",name:"operatingHours",id:"operatingHours",value:s.operatingHours,onChange:c,rows:3,placeholder:`e.g., Mon-Fri: 7am - 8pm
Sat-Sun: 8am - 6pm`,helperText:"This text will be displayed in the footer and contact page."})})]}),e.jsxs(g,{children:[e.jsxs("h2",{className:"mb-4 flex items-center gap-2 text-xl font-bold text-gray-800",children:[e.jsx(N,{className:"h-5 w-5 text-primary-600"}),"System-wide Announcement"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(I,{Icon:N,label:"Enable Announcement Banner",description:"Show a banner at the top of the site.",enabled:s.announcement.enabled,onChange:a=>f("enabled",a)}),e.jsx("div",{children:e.jsx(m,{label:"Announcement Message",name:"announcementMessage",id:"announcementMessage",value:s.announcement.message,onChange:a=>f("message",a.target.value),placeholder:"Enter announcement message"})})]})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-end gap-3",children:e.jsxs(M,{type:"submit",disabled:o||!!i,size:"lg",className:"w-full sm:w-auto",children:[o?e.jsx(y,{className:"mr-2 h-5 w-5 animate-spin"}):e.jsx(F,{className:"mr-2 h-5 w-5"}),"Save Settings"]})})]})]})};export{O as default};
